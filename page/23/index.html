<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hufanglei.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12,"scrollpercent":true,"onmobile":false},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
<meta property="og:type" content="blog">
<meta property="og:title" content="个人博客">
<meta property="og:url" content="https://hufanglei.github.io/page/23/index.html">
<meta property="og:site_name" content="个人博客">
<meta property="og:description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="胡方雷">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://hufanglei.github.io/page/23/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/23/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>个人博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">个人博客</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记录生活中的点点滴滴</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">398</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">105</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">594</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="胡方雷"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">胡方雷</p>
  <div class="site-description" itemprop="description">直到这一刻微笑着说话为止，我至少留下了一公升眼泪</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">594</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">105</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">398</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/hufanglei" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hufanglei" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://hufanglei.blog.csdn.net/" title="CSDN → https:&#x2F;&#x2F;hufanglei.blog.csdn.net" rel="noopener me" target="_blank"><i class="crosshairs fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:690328661@qq.com" title="E-Mail → mailto:690328661@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1518938&auto=1&height=66"></iframe>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title">
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="http://www.alloyteam.com/nav/" title="http:&#x2F;&#x2F;www.alloyteam.com&#x2F;nav&#x2F;" rel="noopener" target="_blank">Web前端导航</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://www.uisdc.com/" title="http:&#x2F;&#x2F;www.uisdc.com&#x2F;" rel="noopener" target="_blank">优设</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://www.zhangxinxu.com/" title="http:&#x2F;&#x2F;www.zhangxinxu.com&#x2F;" rel="noopener" target="_blank">牛人文档</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://ife.baidu.com/" title="http:&#x2F;&#x2F;ife.baidu.com&#x2F;" rel="noopener" target="_blank">百度前端技术学院</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://wf.uisdc.com/cn/" title="http:&#x2F;&#x2F;wf.uisdc.com&#x2F;cn&#x2F;" rel="noopener" target="_blank">google前端开发基础</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hufanglei.github.io/2020/06/01/%E5%8D%8E%E4%B8%BA%E4%BA%91%E7%9A%84obs%E4%B9%8B%E8%87%AA%E5%AE%9A%E4%B9%89springboot-starter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="胡方雷">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/01/%E5%8D%8E%E4%B8%BA%E4%BA%91%E7%9A%84obs%E4%B9%8B%E8%87%AA%E5%AE%9A%E4%B9%89springboot-starter/" class="post-title-link" itemprop="url">华为云的obs之自定义springboot-starter</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-01 19:29:41" itemprop="dateCreated datePublished" datetime="2020-06-01T19:29:41+08:00">2020-06-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-24 11:37:59" itemprop="dateModified" datetime="2025-01-24T11:37:59+08:00">2025-01-24</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>9 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<p>@[toc]</p>
<blockquote>
<p>华为云的obs如果自己调用api的话，接口太多，很多不需要，依赖也很多（需要调用好几个jar包)。于是想着自己给封装下，引一个jar就能用多好啊。于是自己利用业余时间自定义了这个starer，可以快速投入开发，省时省力，希望帮助到大家。</p>
</blockquote>
<h1 id="一、自定义的starter封装好的几个常用方法"><a href="#一、自定义的starter封装好的几个常用方法" class="headerlink" title="一、自定义的starter封装好的几个常用方法:"></a>一、自定义的starter封装好的几个常用方法:</h1><h2 id="一-桶的操作"><a href="#一-桶的操作" class="headerlink" title="一.桶的操作"></a>一.桶的操作</h2><ul>
<li>查询所有桶</li>
<li>桶的新增</li>
<li>桶的删除</li>
<li>设置桶内文件对象过期时间</li>
</ul>
<h2 id="二-对象的操作"><a href="#二-对象的操作" class="headerlink" title="二.对象的操作"></a>二.对象的操作</h2><ul>
<li>1.查询某个桶的所有对象</li>
<li>2.上传某个对象（全局访问权限版2个）（通过流+通过file对象）</li>
<li>3.上传某个对象(设置对象自定义元数据版)</li>
<li>4.获取某个对象的所有信息</li>
<li>5.获取某个对象的元数据</li>
<li>6.获取某个对象的流</li>
<li>7.拷贝对象</li>
<li>8.删除单个对象  </li>
<li>9.下载某个对象到本地</li>
</ul>
<h2 id="三-文件夹的操作"><a href="#三-文件夹的操作" class="headerlink" title="三.文件夹的操作"></a>三.文件夹的操作</h2><ul>
<li>1.创建文件夹</li>
<li>2.判断对象是否是文件夹</li>
<li>3.列举文件夹中的所有对象</li>
<li>4.删除某个文件夹下的所有对象</li>
</ul>
<h1 id="二、springboot-华为云的obs-的starter核心工具类代码"><a href="#二、springboot-华为云的obs-的starter核心工具类代码" class="headerlink" title="二、springboot(华为云的obs)的starter核心工具类代码"></a>二、springboot(华为云的obs)的starter核心工具类代码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Title: ObsUtils</span></span><br><span class="line"><span class="comment"> * Description: obs操作工具类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hfl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-05-27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObsService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(ObsService.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ObsClient obsClient;</span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line">    <span class="keyword">private</span> String bucketLoc;</span><br><span class="line">    <span class="keyword">private</span> ObsConfiguration config;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ObsService</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ObsService</span><span class="params">(String bucketName, String bucketLoc, ObsConfiguration config)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bucketName = bucketName;</span><br><span class="line">        <span class="built_in">this</span>.bucketLoc = bucketLoc;</span><br><span class="line">        <span class="built_in">this</span>.config = config;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有桶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 桶的列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;ObsBucket&gt; <span class="title function_">listBuckets</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ListBucketsRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListBucketsRequest</span>();</span><br><span class="line">        request.setQueryLocation(<span class="literal">true</span>);</span><br><span class="line">        List&lt;ObsBucket&gt; obsBuckets = obsClient.listBuckets(request);</span><br><span class="line">        <span class="keyword">return</span> obsBuckets;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 桶的新增</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bucketName 桶的名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 桶对象信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> ObsBucket <span class="title function_">createBucket</span><span class="params">(String bucketName)</span> &#123;</span><br><span class="line">        <span class="type">ObsBucket</span> <span class="variable">obsBucket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObsBucket</span>(bucketName, bucketLoc);</span><br><span class="line">        obsBucket.setBucketName(bucketName);</span><br><span class="line">        <span class="keyword">return</span> obsClient.createBucket(obsBucket);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 桶的删除</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bucketName 桶的名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> HeaderResponse <span class="title function_">deleteBucket</span><span class="params">(String bucketName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> obsClient.deleteBucket(bucketName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置桶内指定前缀的文件对象 过期时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> prefix         什么前缀的文件过期（比如/tmp）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expirationDays 几天后过期</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> HeaderResponse <span class="title function_">setLiftConfig</span><span class="params">(String prefix, Integer expirationDays)</span> &#123;</span><br><span class="line">        <span class="type">LifecycleConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LifecycleConfiguration</span>();</span><br><span class="line">        LifecycleConfiguration.<span class="type">Rule</span> <span class="variable">rule</span> <span class="operator">=</span> config.<span class="keyword">new</span> <span class="title class_">Rule</span>();</span><br><span class="line">        rule.setEnabled(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//过期规则名称</span></span><br><span class="line">        rule.setId(String.valueOf(UUID.randomUUID()));</span><br><span class="line">        rule.setPrefix(prefix);</span><br><span class="line">        LifecycleConfiguration.<span class="type">Expiration</span> <span class="variable">expiration</span> <span class="operator">=</span> config.<span class="keyword">new</span> <span class="title class_">Expiration</span>();</span><br><span class="line">        <span class="comment">// 指定满足前缀的对象创建x天后过期</span></span><br><span class="line">        expiration.setDays(expirationDays);</span><br><span class="line">        LifecycleConfiguration.<span class="type">NoncurrentVersionExpiration</span> <span class="variable">noncurrentVersionExpiration</span> <span class="operator">=</span> config.<span class="keyword">new</span> <span class="title class_">NoncurrentVersionExpiration</span>();</span><br><span class="line">        <span class="comment">// 指定满足前缀的对象成为历史版本x天后过期</span></span><br><span class="line">        noncurrentVersionExpiration.setDays(expirationDays);</span><br><span class="line">        rule.setNoncurrentVersionExpiration(noncurrentVersionExpiration);</span><br><span class="line">        config.addRule(rule);</span><br><span class="line">        <span class="keyword">return</span> obsClient.setBucketLifecycle(bucketName, config);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询桶的所有对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 桶内对象集合（关键属性getObjectKey）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> ObjectListing <span class="title function_">listObjects</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ObjectListing</span> <span class="variable">listing</span> <span class="operator">=</span> obsClient.listObjects(bucketName);</span><br><span class="line">        <span class="keyword">return</span> listing;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传对象时指定预定义访问策略为公共读(很重要)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectKey   对象的key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream 要上传的文件流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> PutObjectResult <span class="title function_">putObjectAndSetPreAccessStrategy</span><span class="params">(String objectKey, InputStream inputStream)</span> &#123;</span><br><span class="line">        <span class="type">PutObjectRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PutObjectRequest</span>();</span><br><span class="line">        request.setBucketName(bucketName);</span><br><span class="line">        <span class="comment">//对象的key 如:  objectname1/text</span></span><br><span class="line">        request.setObjectKey(objectKey);</span><br><span class="line">        request.setInput(inputStream);</span><br><span class="line">        <span class="comment">//设置对象访问权限为公共读</span></span><br><span class="line">        request.setAcl(AccessControlList.REST_CANNED_PUBLIC_READ);</span><br><span class="line">        <span class="keyword">return</span> obsClient.putObject(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传对象时指定预定义访问策略为公共读(很重要)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectKey   对象的key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 要上传的文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> PutObjectResult <span class="title function_">putObjectAndSetPreAccessStrategy</span><span class="params">(String objectKey, File file)</span> &#123;</span><br><span class="line">        <span class="type">PutObjectRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PutObjectRequest</span>();</span><br><span class="line">        request.setBucketName(bucketName);</span><br><span class="line">        <span class="comment">//对象的key 如:  objectname1/text</span></span><br><span class="line">        request.setObjectKey(objectKey);</span><br><span class="line">        request.setFile(file);</span><br><span class="line">        <span class="comment">//设置对象访问权限为公共读</span></span><br><span class="line">        request.setAcl(AccessControlList.REST_CANNED_PUBLIC_READ);</span><br><span class="line">        <span class="keyword">return</span> obsClient.putObject(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传某个对象并设置对象自定义元数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectKey   要上传的key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metadata    元数据对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream 要上传的文件流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 上传结果</span></span><br><span class="line"><span class="comment">     * //  ObjectMetadata metadata = new ObjectMetadata();</span></span><br><span class="line"><span class="comment">     * //  metadata.addUserMetadata(&quot;property1&quot;, &quot;property-value1&quot;);</span></span><br><span class="line"><span class="comment">     * //  metadata.getMetadata().put(&quot;property2&quot;, &quot;property-value2&quot;);</span></span><br><span class="line"><span class="comment">     * //  C:\\Users\\hufanglei\\Pictures\\timg.jpg&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> PutObjectResult <span class="title function_">putObjectAndSetMeta</span><span class="params">(String objectKey, ObjectMetadata metadata, InputStream inputStream)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> obsClient.putObject(bucketName, objectKey, inputStream, metadata);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取某个对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectKey 对象的key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对象的信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> ObsObject <span class="title function_">getObject</span><span class="params">(String objectKey)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> obsClient.getObject(bucketName, objectKey, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取某个对象的流</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectKey 对象的key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对象的流</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> InputStream <span class="title function_">getObjectInpuStream</span><span class="params">(String objectKey)</span> &#123;</span><br><span class="line">        <span class="type">ObsObject</span> <span class="variable">obsObject</span> <span class="operator">=</span> obsClient.getObject(bucketName, objectKey, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> obsObject.getObjectContent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询对象元数据(查询某个对象的具体信息)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectKey 要查询的key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对象元数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> ObjectMetadata <span class="title function_">getObjectMetadata</span><span class="params">(String objectKey)</span> &#123;</span><br><span class="line">        <span class="comment">//获取对象元数据</span></span><br><span class="line">        <span class="keyword">return</span> obsClient.getObjectMetadata(bucketName, objectKey, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拷贝对象(也可以从一个桶拷贝到另一个桶，这里目前桶和原始文件桶都设置成了配置文件中的桶)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sourceObjectKey 原始key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> destObjectKey   目标key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> CopyObjectResult <span class="title function_">copyObject</span><span class="params">(String sourceObjectKey, String destObjectKey)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sourceBucketName</span> <span class="operator">=</span> bucketName;</span><br><span class="line">        <span class="type">String</span> <span class="variable">destBucketName</span> <span class="operator">=</span> bucketName;</span><br><span class="line">        <span class="keyword">return</span> obsClient.copyObject(sourceBucketName, sourceObjectKey, destBucketName, destObjectKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除单个对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectKey 要删除的key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> DeleteObjectResult <span class="title function_">deletObj</span><span class="params">(String objectKey)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> obsClient.deleteObject(bucketName, objectKey);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载某个对象到本地</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectKey     对象的key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> localFilePath 本地文件路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ObsException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">downloadToLocalFile</span><span class="params">(String objectKey, String localFilePath)</span> <span class="keyword">throws</span> ObsException, IOException &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">localFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(localFilePath);</span><br><span class="line">        <span class="keyword">if</span> (!localFile.getParentFile().exists()) &#123;</span><br><span class="line">            localFile.getParentFile().mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ObsObject</span> <span class="variable">obsObject</span> <span class="operator">=</span> obsClient.getObject(bucketName, objectKey, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">ReadableByteChannel</span> <span class="variable">rchannel</span> <span class="operator">=</span> Channels.newChannel(obsObject.getObjectContent());</span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">4096</span>);</span><br><span class="line">        <span class="type">WritableByteChannel</span> <span class="variable">wchannel</span> <span class="operator">=</span> Channels.newChannel(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(localFilePath)));</span><br><span class="line">        <span class="keyword">while</span> (rchannel.read(buffer) != -<span class="number">1</span>) &#123;</span><br><span class="line">            buffer.flip();</span><br><span class="line">            wchannel.write(buffer);</span><br><span class="line">            buffer.clear();</span><br><span class="line">        &#125;</span><br><span class="line">        rchannel.close();</span><br><span class="line">        wchannel.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个文件夹，必须带有/后缀</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keySuffixWithSlash1 文件夹名称（必须带有/后缀）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> PutObjectResult <span class="title function_">createEmptyFolder</span><span class="params">(String keySuffixWithSlash1)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> obsClient.putObject(bucketName, keySuffixWithSlash1, <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断对象是否是文件夹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keySuffixWithSlash1 文件夹名: 如:   &quot;MyObjectKey1/&quot;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 布尔值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmptyFolder</span><span class="params">(String keySuffixWithSlash1)</span>  &#123;</span><br><span class="line">        <span class="type">ObsObject</span> <span class="variable">object</span> <span class="operator">=</span> obsClient.getObject(bucketName, keySuffixWithSlash1, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (object != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> object.getMetadata().getContentLength() == <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列举某个文件夹下的所有对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> folderPrefix 件夹名（必须/结尾）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对象集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> ObjectListing <span class="title function_">listObjectsByFolder</span><span class="params">(String folderPrefix)</span> &#123;</span><br><span class="line">        <span class="type">ListObjectsRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListObjectsRequest</span>(bucketName);</span><br><span class="line">        <span class="comment">// 设置文件夹对象名&quot;dir/&quot;为前缀</span></span><br><span class="line">        <span class="comment">// request.setPrefix(&quot;dir/&quot;);</span></span><br><span class="line">        request.setPrefix(folderPrefix);</span><br><span class="line">        <span class="comment">//列举文件个数</span></span><br><span class="line">        request.setMaxKeys(<span class="number">1000</span>);</span><br><span class="line">        ObjectListing result;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            result = obsClient.listObjects(request);</span><br><span class="line">            <span class="keyword">for</span> (ObsObject obsObject : result.getObjects()) &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;\t&quot;</span> + obsObject.getObjectKey());</span><br><span class="line">                logger.info(<span class="string">&quot;\t&quot;</span> + obsObject.getOwner());</span><br><span class="line">            &#125;</span><br><span class="line">            request.setMarker(result.getNextMarker());</span><br><span class="line">        &#125; <span class="keyword">while</span> (result.isTruncated());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除某个文件夹下的所有对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> folderPrefix 文件夹名（必须/结尾）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否删除成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ObsClientAnnotation</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteListObjectsByFolder</span><span class="params">(String folderPrefix)</span> &#123;</span><br><span class="line">        <span class="type">ListObjectsRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListObjectsRequest</span>(bucketName);</span><br><span class="line">        <span class="comment">// 设置文件夹对象名&quot;/xx/xxx/&quot;为前缀</span></span><br><span class="line">        request.setPrefix(folderPrefix);</span><br><span class="line">        <span class="comment">//列举文件个数</span></span><br><span class="line">        request.setMaxKeys(<span class="number">1000</span>);</span><br><span class="line">        ObjectListing result;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            result = obsClient.listObjects(request);</span><br><span class="line">            <span class="keyword">for</span> (ObsObject obsObject : result.getObjects()) &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;\t&quot;</span> + obsObject.getObjectKey());</span><br><span class="line">                logger.info(<span class="string">&quot;\t&quot;</span> + obsObject.getOwner());</span><br><span class="line">                <span class="comment">//执行删除</span></span><br><span class="line">                obsClient.deleteObject(bucketName, obsObject.getObjectKey());</span><br><span class="line">            &#125;</span><br><span class="line">            request.setMarker(result.getNextMarker());</span><br><span class="line">        &#125; <span class="keyword">while</span> (result.isTruncated());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="三、如何使用starter"><a href="#三、如何使用starter" class="headerlink" title="三、如何使用starter"></a>三、如何使用starter</h1><h2 id="0-前提-请注意"><a href="#0-前提-请注意" class="headerlink" title="0.前提 请注意"></a>0.前提 请注意</h2><ul>
<li>obs的jar包在maven仓库的版本很老了，所以去官网下载比较新的jar包。</li>
<li>需要将esdk-obs-java-3.19.11.1.jar加载进依赖或者上传到私服，我已经上传到自己的私服了，直接引pom即可，直接使用会报错</li>
<li>如果报错，请手动添加放在&#x2F;obs-upload-spring-boot-starter&#x2F;doc&#x2F;lib下esdk-obs-java-3.19.11.1.jar</li>
</ul>
<h2 id="使用步骤1-引入自定义obs的starter"><a href="#使用步骤1-引入自定义obs的starter" class="headerlink" title="使用步骤1.引入自定义obs的starter"></a>使用步骤1.引入自定义obs的starter</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.wuzheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>obs-upload-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="使用步骤2-配置文件设置参数"><a href="#使用步骤2-配置文件设置参数" class="headerlink" title="使用步骤2.配置文件设置参数"></a>使用步骤2.配置文件设置参数</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">obs:</span></span><br><span class="line">  <span class="comment">#端点（xx和地区对应）</span></span><br><span class="line">  <span class="attr">endPoint:</span> <span class="string">http://obs.xxx.myhuaweicloud.com</span></span><br><span class="line">  <span class="attr">ak:</span> <span class="string">yourself</span> <span class="string">ak</span></span><br><span class="line">  <span class="attr">sk:</span> <span class="string">yourslef</span> <span class="string">sk</span></span><br><span class="line">  <span class="attr">bucketName:</span> <span class="string">yourself</span> <span class="string">桶的名字</span></span><br><span class="line">  <span class="comment">#地区</span></span><br><span class="line">  <span class="attr">bucketLoc:</span> <span class="string">xxx</span></span><br></pre></td></tr></table></figure>
<h2 id="使用步骤3-在springboot的启动类上加上启动注解"><a href="#使用步骤3-在springboot的启动类上加上启动注解" class="headerlink" title="使用步骤3.在springboot的启动类上加上启动注解"></a>使用步骤3.在springboot的启动类上加上启动注解</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableObsAutoConfiguration</span></span><br></pre></td></tr></table></figure>

<h2 id="项目中调用示例"><a href="#项目中调用示例" class="headerlink" title="项目中调用示例"></a>项目中调用示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ObsService obsService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">//以上传为例:其他方法看上面的接口列表</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">obsUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">objectKey</span> <span class="operator">=</span> <span class="string">&quot;XX&quot;</span>;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;XXXX&quot;</span>);</span><br><span class="line">        obsService.putObjectAndSetPreAccessStrategy(objectKey,  file);        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h1 id="四、springboot-华为云的obs-starter开源项目地址"><a href="#四、springboot-华为云的obs-starter开源项目地址" class="headerlink" title="四、springboot(华为云的obs)starter开源项目地址"></a>四、springboot(华为云的obs)starter开源项目地址</h1><p><a target="_blank" rel="noopener" href="https://gitee.com/hufanglei/obs-upload-spring-boot-starter">https://gitee.com/hufanglei/obs-upload-spring-boot-starter</a></p>
<hr>
<p>个人微信公众号：<br>搜索： 怒放de每一天<br>不定时推送相关文章，期待和大家一起成长！！<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/undefined/img/2025-1-13/42409b1dbd9a6b7ff63471ea0769592d_1737631173950.png" alt="在这里插入图片描述"></p>
<hr>
<p>完</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hufanglei.github.io/2020/05/24/%E9%93%BE%E8%B7%AF%E7%9B%91%E6%8E%A7(skywalking)%E9%9B%86%E6%88%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="胡方雷">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/24/%E9%93%BE%E8%B7%AF%E7%9B%91%E6%8E%A7(skywalking)%E9%9B%86%E6%88%90/" class="post-title-link" itemprop="url">链路监控(skywalking)集成</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-24 19:06:57" itemprop="dateCreated datePublished" datetime="2020-05-24T19:06:57+08:00">2020-05-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-24 11:37:59" itemprop="dateModified" datetime="2025-01-24T11:37:59+08:00">2025-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/spring%E5%AE%B6%E6%97%8F-%E8%BF%90%E7%BB%B4-springcloud/" itemprop="url" rel="index"><span itemprop="name">spring家族 运维 springcloud</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<p>@[TOC]</p>
<h1 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介:"></a>一、简介:</h1><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/ab032801a7d346c3e48499405d326501_1737630701374.png" alt="在这里插入图片描述"><br>整体架构包含如下三个组成部分：</p>
<ol>
<li>探针(agent)负责进行数据的收集，包含了Tracing和Metrics的数据，agent会被安装到服务所在的<br>服务器上，以方便数据的获取。</li>
<li>可观测性分析平台OAP(Observability Analysis Platform)，接收探针发送的数据，并在内存中使<br>用分析引擎（Analysis Core)进行数据的整合运算，然后将数据存储到对应的存储介质上，比如<br>Elasticsearch、MySQL数据库、H2数据库等。同时OAP还使用查询引擎(Query Core)提供HTTP查<br>询接口。</li>
<li>Skywalking提供单独的UI进行数据的查看，此时UI会调用OAP提供的接口，获取对应的数据然后<br>进行展示。</li>
</ol>
<h1 id="二-部署："><a href="#二-部署：" class="headerlink" title="二.部署："></a>二.部署：</h1><p>具体部署步骤，不在本文章内容，之前的文章有提到过。<br>个人部署的是个单机版，用于开发测试，server和webui部署在一个机器上。</p>
<p>OAPserver地址:  192.168.1.101:11800</p>
<p>webui可视化页面: <a target="_blank" rel="noopener" href="http://192.168.1.101:10000/">http://192.168.1.101:10000/</a></p>
<blockquote>
<p>自己部署可以在配置文件中自定义端口号</p>
</blockquote>
<h1 id="三、idea中开发使用"><a href="#三、idea中开发使用" class="headerlink" title="三、idea中开发使用"></a>三、idea中开发使用</h1><h2 id="1-项目中放置探针"><a href="#1-项目中放置探针" class="headerlink" title="1.项目中放置探针"></a>1.项目中放置探针</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/34797e0479f6113640a4d44ec7cab6c9_1737630701374.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>在服务器中skywalking解压包下有个agent的文件夹。将这个agent文件和和里面的内容全部拷贝到本地某个盘符或者开发的项目中。</p>
</blockquote>
<p>以微服务: common_user为例.</p>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/32a3b6e17e744862d23805441825bae5_1737630716271.png" alt="在这里插入图片描述"></p>
<h2 id="2-启动时指定OAPServer地址和开发的微服务名称"><a href="#2-启动时指定OAPServer地址和开发的微服务名称" class="headerlink" title="2.启动时指定OAPServer地址和开发的微服务名称"></a>2.启动时指定OAPServer地址和开发的微服务名称</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/21246ec6be5feaf53c07f6fd228196ba_1737630716271.png" alt="在这里插入图片描述"></p>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/aa7958779b50d03f9f6ddaa77ef29d76_1737630716271.png" alt="在这里插入图片描述"></p>
<blockquote>
<p><code> -Dskywalking.agent.service_name=common_user -Dskywalking.collector.backend_service=192.168.1.101:11800 -javaagent:E:\workspace\springboot2\wz-test-demo\test-jwt-gateway\common-user\agent\skywalking-agent.jar</code></p>
</blockquote>
<h2 id="3-测试"><a href="#3-测试" class="headerlink" title="3.测试"></a>3.测试</h2><p>启动common_user服务。调用其中一个接口:</p>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/c916ffc8f31f23951666afa26df1c123_1737630716271.png" alt="在这里插入图片描述"></p>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/ef68f945c12ed90a901f9152532cede4_1737630716271.png" alt="在这里插入图片描述"></p>
<p>去skywalking webui地址<a target="_blank" rel="noopener" href="http://192.168.1.101:10000/%E4%B8%8A%E6%9F%A5%E7%9C%8B%E8%BF%BD%E8%B8%AA%E6%83%85%E5%86%B5">http://192.168.1.101:10000/上查看追踪情况</a>:<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/a7b249a2bf53288eab09d47c0d26488d_1737630727471.png" alt="在这里插入图片描述"></p>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/6872e4997a7a268aa7c9d6f7378978b8_1737630727471.png" alt="在这里插入图片描述"></p>
<p>更多追踪信息，可以去<a target="_blank" rel="noopener" href="http://192.168.1.101:10000/%E4%B8%8A%E6%9F%A5%E7%9C%8B%E3%80%82">http://192.168.1.101:10000/上查看。</a></p>
<p>如果开发中使用，服务名称最好加上自己的名字或其他标识，防止和别人重复，跟踪不到自己的信息。</p>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/cc705341c360eb886b91cef2f0e3cf19_1737630727471.png" alt="在这里插入图片描述"></p>
<h1 id="四、服务器上使用skywalking"><a href="#四、服务器上使用skywalking" class="headerlink" title="四、服务器上使用skywalking"></a>四、服务器上使用skywalking</h1><p>同理也是把agent放在该服务器上。例如我把agent文件夹放在&#x2F;usr&#x2F;local&#x2F;skywalking文件夹下面。</p>
<blockquote>
<p><code>java -javaagent:/usr/local/skywalking/agent/skywalking-agent.jar -Dskywalking.agent.service_name=common_user -jar common_user .jar &amp;</code></p>
</blockquote>
<p>启动jar时指定 agent和服务名称即可。</p>
<hr>
<p>个人微信公众号：<br>搜索： 怒放de每一天<br>不定时推送相关文章，期待和大家一起成长！！<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/undefined/img/2025-1-13/42409b1dbd9a6b7ff63471ea0769592d_1737631173950.png" alt="在这里插入图片描述"></p>
<hr>
<p>完</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hufanglei.github.io/2020/05/24/elastic-job%20%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E9%9B%86%E6%88%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="胡方雷">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/24/elastic-job%20%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E9%9B%86%E6%88%90/" class="post-title-link" itemprop="url">elastic-job 定时任务集成</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-24 17:30:25" itemprop="dateCreated datePublished" datetime="2020-05-24T17:30:25+08:00">2020-05-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-24 11:37:59" itemprop="dateModified" datetime="2025-01-24T11:37:59+08:00">2025-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/spring%E5%AE%B6%E6%97%8F/" itemprop="url" rel="index"><span itemprop="name">spring家族</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>11 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<p>@[toc]</p>
<blockquote>
<p>“前些天发现了一个巨牛的人工智能学习网站，通俗易懂，风趣幽默，忍不住分享一下给大家。<a target="_blank" rel="noopener" href="https://www.captainai.net/i690">点击跳转到网站</a>。”</p>
</blockquote>
<h1 id="一、基本使用"><a href="#一、基本使用" class="headerlink" title="一、基本使用"></a>一、基本使用</h1><p>elastic-job的任务类型分为三种：</p>
<ul>
<li>a. Simple类型作业,意为简单实现，未经任何封装的类型。需实现SimpleJob接口。该接口仅提供单一方法用于覆盖，此方法将定时执行。与Quartz原生接口相似，但提供了弹性扩缩容和分片等功能。</li>
<li>b. Dataflow类型用于处理数据流，需实现DataflowJob接口。该接口提供2个方法可供覆盖，分别用于抓取(fetchData)和处理(processData)数据。</li>
<li>c.Script类型作业意为脚本类型作业，支持shell，python，perl等所有类型脚本。只需通过控制台或代码配置scriptCommandLine即可，无需编码。执行脚本路径可包含参数，参数传递完毕后，作业框架会自动追加最后一个参数为作业运行时信息。</li>
</ul>
<p>本文档提供的jar包是对elastic-job进行了二次封装，封装成了springboot的starter启动器，使用更加简单。后续开发引入我们自定义的starter完成定时任务功能即可。</p>
<p>先以最简单的SimpleJob类型说明如何使用集成：</p>
<h2 id="第一步添加依赖："><a href="#第一步添加依赖：" class="headerlink" title="第一步添加依赖："></a>第一步添加依赖：</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--elastic-job的starter集成--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.wuzheng<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-elastic-job-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://gitee.com/hufanglei/elastic-job-learn/tree/master/spring-boot-elastic-job-starter">点击此处查看starter源码</a>，可以自己下载到本地或私服，引入依赖</p>
</blockquote>
<h2 id="第二步-增加Zookeeper注册中心的配置"><a href="#第二步-增加Zookeeper注册中心的配置" class="headerlink" title="第二步:增加Zookeeper注册中心的配置"></a>第二步:增加Zookeeper注册中心的配置</h2><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">elastic.job.zk.serverLists=<span class="number">192.168.0.121</span>:<span class="number">2181,192.168</span>.<span class="number">0.122:2181</span>,<span class="number">192.168.0.129</span>:<span class="number">2181</span></span><br><span class="line">elastic.job.zk.namespace=yourself namespace</span><br></pre></td></tr></table></figure>
<p>Zookeeper配置的前缀是elastic.job.zk，详细的属性配置请查看<a target="_blank" rel="noopener" href="https://gitee.com/hufanglei/elastic-job-learn/blob/master/spring-boot-elastic-job-starter/src/main/java/com/wuzheng/elasticjob/autoconfigure/ZookeeperProperties.java">ZookeeperProperties</a></p>
<h2 id="第三步-开启Elastic-Job自动配置"><a href="#第三步-开启Elastic-Job自动配置" class="headerlink" title="第三步:开启Elastic-Job自动配置"></a>第三步:开启Elastic-Job自动配置</h2><p>开启自动配置只需要在Spring Boot的启动类上增加@EnableElasticJob注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.builder.SpringApplicationBuilder;</span><br><span class="line"><span class="keyword">import</span> com.cxytiandi.elasticjob.annotation.EnableElasticJob;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ElasticJob Spring Boot集成案例</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hfl</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableElasticJob</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JobApplication</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		SpringApplication.run(JobApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第四步-配置任务"><a href="#第四步-配置任务" class="headerlink" title="第四步 配置任务"></a>第四步 配置任务</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@ElasticJobConf(<span class="type">name</span> = &quot;MySimpleJob&quot;, cron = &quot;0/10 * * * * ?&quot;, </span><br><span class="line">	shardingItemParameters = &quot;0=0,1=1&quot;, description = &quot;简单任务&quot;)</span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> MySimpleJob implements SimpleJob &#123;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">public</span> <span class="type">void</span> <span class="keyword">execute</span>(ShardingContext context) &#123;</span><br><span class="line">		String shardParamter = context.getShardingParameter();</span><br><span class="line">		<span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;分片参数：&quot;+shardParamter);</span><br><span class="line">		<span class="type">int</span> <span class="keyword">value</span> = <span class="type">Integer</span>.parseInt(shardParamter);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (i % <span class="number">2</span> == <span class="keyword">value</span>) &#123;</span><br><span class="line">				String <span class="type">time</span> = <span class="built_in">new</span> SimpleDateFormat(&quot;HH:mm:ss&quot;).format(<span class="built_in">new</span> <span class="type">Date</span>());</span><br><span class="line">				<span class="keyword">System</span>.<span class="keyword">out</span>.println(<span class="type">time</span> + &quot;:开始执行简单任务&quot; + i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>任务的配置只需要在任务类上增加一个ElasticJobConf注解，注解中有很多属性，这些属性都是任务的配置，详细的属性配置如下链接：<br><a target="_blank" rel="noopener" href="https://gitee.com/hufanglei/elastic-job-learn/blob/master/spring-boot-elastic-job-starter/src/main/java/com/wuzheng/elasticjob/annotation/ElasticJobConf.java">ElasticJobConf.java</a></p>
</blockquote>
<p>测试下，启动自己的任务所在微服务，看下效果<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/47379dcec923ffb3a63d5a1195a75293_1737630727471.png" alt="在这里插入图片描述"></p>
<p>自此，最简单的小demo其实已经完成了，但是实际中还有一些高级功能需要了解，在此也一并说明下：</p>
<h1 id="二、扩展功能"><a href="#二、扩展功能" class="headerlink" title="二、扩展功能"></a>二、扩展功能</h1><p>扩展包括:</p>
<ul>
<li>1.想在配置文件设置任务参数怎么写?</li>
<li>2.每次任务执行日志如何记录?</li>
<li>3.想执行业务脚本任务如何操作?</li>
<li>4.任务执行前后如何添加监听事件?</li>
<li>5.任务业务执行失败如何自定义异常处理?</li>
<li>6.动态作业怎么实现?</li>
</ul>
<p>下面具体说明：</p>
<h2 id="1-想在配置文件设置任务参数怎么写"><a href="#1-想在配置文件设置任务参数怎么写" class="headerlink" title="1.想在配置文件设置任务参数怎么写?"></a>1.想在配置文件设置任务参数怎么写?</h2><p>这个问题即application.properties中如何配置任务信息?</p>
<p>使用注解是比较方便，但是在属性文件中配置任务的参数信息更灵活，也便于以后使用appolo或者necos等工具进行集中配置文件管理。</p>
<p>我们可以同时指定注解方法，也可以同时在属性文件中设置，但是当属性文件中配置了任务的信息，优先级就比注解中的高。具体做法如下:</p>
<p>首先还是在任务类上加@ElasticJobConf(name &#x3D; “MySimpleJob”)注解，只需要增加一个name即可，任务名是唯一的。</p>
<p>剩下的配置都可以在属性文件中进行配置，格式为elastic.job.任务名.配置属性&#x3D;属性值</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">elastic.job.MySimpleJob.cron</span>=<span class="number">0</span>/<span class="number">10</span> * * * * ?</span><br><span class="line"><span class="attr">elastic.job.MySimpleJob.overwrite</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">elastic.job.MySimpleJob.shardingTotalCount</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">elastic.job.MySimpleJob.shardingItemParameters</span>=<span class="number">0</span>=<span class="number">0</span>,<span class="number">1</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">elastic.job.MySimpleJob.jobParameter</span>=test</span><br><span class="line"><span class="attr">elastic.job.MySimpleJob.failover</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">elastic.job.MySimpleJob.misfire</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">elastic.job.MySimpleJob.description</span>=simple job</span><br><span class="line"><span class="attr">elastic.job.MySimpleJob.monitorExecution</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">elastic.job.MySimpleJob.listener</span>=com.cxytiandi.job.core.MessageElasticJobListener</span><br><span class="line"><span class="attr">elastic.job.MySimpleJob.jobExceptionHandler</span>=com.cxytiandi.job.core.CustomJobExceptionHandler</span><br><span class="line"><span class="attr">elastic.job.MySimpleJob.disabled</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/1e87cf2a6f53320ef719946676b68101_1737630739898.png" alt="在这里插入图片描述"><br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/a65c605049268cb8fc43edc0377b1325_1737630739898.png" alt="在这里插入图片描述"><br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/a9fa3d151200117c44e4d3ae67df836e_1737630739898.png" alt="在这里插入图片描述"></p>
<h2 id="2-每次任务执行日志如何记录"><a href="#2-每次任务执行日志如何记录" class="headerlink" title="2.每次任务执行日志如何记录?"></a>2.每次任务执行日志如何记录?</h2><p>elastic-job已经为我们提供了事件追踪数据源功能，可以将每一次的任务执行情况，任务执行轨迹，任务执行历史持久化到数据库或者其他日志收集框架中，下面演示如何保存到数据库中：</p>
<p>事件追踪功能在注解中也只需要配置eventTraceRdbDataSource&#x3D;你的数据源 就可以使用了，数据源用什么连接池无限制，唯一需要注意的一点是你的数据源必须在spring-boot-elastic-job-starter之前创建，因为spring-boot-elastic-job-starter中依赖了你的数据源，下面我以druid作为连接池来进行讲解。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置连接池属性：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.datasource</span><span class="selector-class">.druid</span><span class="selector-class">.log</span>.url=jdbc:mysql:<span class="comment">//localhost:3306/event_log</span></span><br><span class="line">spring<span class="selector-class">.datasource</span><span class="selector-class">.druid</span><span class="selector-class">.log</span>.username=root</span><br><span class="line">spring<span class="selector-class">.datasource</span><span class="selector-class">.druid</span><span class="selector-class">.log</span>.password=<span class="number">123456</span></span><br><span class="line">spring<span class="selector-class">.datasource</span><span class="selector-class">.druid</span><span class="selector-class">.log</span>.driver-class-name=com<span class="selector-class">.mysql</span><span class="selector-class">.jdbc</span>.Driver</span><br></pre></td></tr></table></figure>

<p>然后在项目中定义一个配置类，配置连接池，手动配置的原因是连接池可以在elastic-job-starter之前被初始化。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Configuration</span></span><br><span class="line">public class BeanConfig &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 任务执行事件数据源</span></span><br><span class="line"><span class="comment">	 * @return</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="variable">@Bean</span>(<span class="string">&quot;datasource&quot;</span>)</span><br><span class="line">	<span class="variable">@ConfigurationProperties</span>(<span class="string">&quot;spring.datasource.druid.log&quot;</span>)</span><br><span class="line">	public DataSource <span class="built_in">dataSourceTwo</span>()&#123;</span><br><span class="line">	    <span class="selector-tag">return</span> <span class="selector-tag">DruidDataSourceBuilder</span><span class="selector-class">.create</span>()<span class="selector-class">.build</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后在注解中增加数据源的配置eventTraceRdbDataSource 即可：<br>注解配置方式如下:</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@ElasticJobConf<span class="params">(<span class="attr">name</span> = &quot;MySimpleJob&quot;, <span class="attr">cron</span> = &quot;0/10 * * * * ?&quot;, </span></span><br><span class="line"><span class="params">	<span class="attr">shardingItemParameters</span> = &quot;<span class="attr">0</span>=0,<span class="attr">1</span>=1&quot;, <span class="attr">description</span> = &quot;简单任务&quot;, <span class="attr">eventTraceRdbDataSource</span> = &quot;datasource&quot;)</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/03679a63ddbc005031043d57626bfb75_1737630739898.png" alt="在这里插入图片描述"><br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/9f1f5b3234d6fcdc4ad67bc0e7213c36_1737630739898.png" alt="在这里插入图片描述"><br>也可以通过官方提供的可视化工具看到任务执行情况<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/050fa8e4e3ba307b73f881a7a9bb0b31_1737630754371.png" alt="在这里插入图片描述"></p>
<p><code>注意: 经测试:</code></p>
<p><code>1：经测试: 该功能Mysql数据库的话只支持5.7，Mysql5.8并不会生效</code></p>
<p><code>2： 数据库名必须是elastic_job_log 才会自动创建这2张表，其他数据库名请手动添加job_execution_log，job_status_trace_log这2张表（后面附2张表建表sql）</code></p>
<p><code>3：zookeepr注册中心必须能够连到mysql</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `job_execution_log` (</span><br><span class="line">  `id` <span class="type">varchar</span>(<span class="number">40</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `job_name` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;作业名称&#x27;</span>,</span><br><span class="line">  `task_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;任务名称,每次作业运行生成新任务&#x27;</span>,</span><br><span class="line">  `hostname` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;主机名称&#x27;</span>,</span><br><span class="line">  `ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;主机IP&#x27;</span>,</span><br><span class="line">  `sharding_item` <span class="type">int</span> <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;分片项&#x27;</span>,</span><br><span class="line">  `execution_source` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;作业执行来源。可选值为NORMAL_TRIGGER, MISFIRE, FAILOVER&#x27;</span>,</span><br><span class="line">  `failure_cause` <span class="type">varchar</span>(<span class="number">4000</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;执行失败原因&#x27;</span>,</span><br><span class="line">  `is_success` <span class="type">int</span> <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;是否执行成功&#x27;</span>,</span><br><span class="line">  `start_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;作业开始执行时间&#x27;</span>,</span><br><span class="line">  `complete_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;作业结束执行时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;历史轨迹表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> `job_status_trace_log` (</span><br><span class="line">  `id` <span class="type">varchar</span>(<span class="number">40</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `job_name` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;作业名称&#x27;</span>,</span><br><span class="line">  `original_task_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;原任务id&#x27;</span>,</span><br><span class="line">  `task_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;任务id&#x27;</span>,</span><br><span class="line">  `slave_id` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;执行作业服务器的名称，Lite版本为服务器的IP地址，Cloud版本为Mesos执行机主键&#x27;</span>,</span><br><span class="line">  `source` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;任务执行源，可选值为CLOUD_SCHEDULER, CLOUD_EXECUTOR, LITE_EXECUTOR&#x27;</span>,</span><br><span class="line">  `execution_type` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;任务执行类型，可选值为NORMAL_TRIGGER, MISFIRE, FAILOVER&#x27;</span>,</span><br><span class="line">  `sharding_item` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;分片项集合，多个分片项以逗号分隔&#x27;</span>,</span><br><span class="line">  `state` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;任务执行状态，可选值为TASK_STAGING, TASK_RUNNING, TASK_FINISHED, TASK_KILLED, TASK_LOST, TASK_FAILED, TASK_ERROR&#x27;</span>,</span><br><span class="line">  `message` <span class="type">varchar</span>(<span class="number">4000</span>) <span class="keyword">CHARACTER SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;相关信息&#x27;</span>,</span><br><span class="line">  `creation_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;记录创建时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`),</span><br><span class="line">  KEY `TASK_ID_STATE_INDEX` (`task_id`,`state`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;历史状态表&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="3-想执行业务脚本任务如何操作"><a href="#3-想执行业务脚本任务如何操作" class="headerlink" title="3.想执行业务脚本任务如何操作?"></a>3.想执行业务脚本任务如何操作?</h2><p>elastic-job提供了Script任务类型.<br>由于Script任务的执行逻辑是在具体的脚本中，是通过scriptCommandLine来指定执行脚本的路径。我这边为了统一的去发现项目中的任务列表，还是需要建一个脚本的Java类，加上ElasticJobConf注解，只是不需要写逻辑而已，示例如下：</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 脚本任务不需要写逻辑，逻辑在被执行的脚本中，这边只是定义一个任务而已</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ElasticJobConf</span>(name = <span class="string">&quot;MyScriptJob&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="title class_"><span class="keyword">class</span> <span class="title">MyScriptJob</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">ScriptJob</span></span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> void execute(ShardingContext context) &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">elastic.job.MyScriptJob.cron</span>=<span class="number">0</span>/<span class="number">10</span> * * * * ?</span><br><span class="line"><span class="attr">elastic.job.MyScriptJob.overwrite</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">elastic.job.MyScriptJob.scriptCommandLine</span>=D:\\<span class="number">1</span>.bat</span><br></pre></td></tr></table></figure>
<p>1.bat脚本内容如下:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@echo</span> ------【脚本任务】Sharding <span class="attribute">Context</span>: %*</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/f5c8bd1f17b186cf9ba65211763e1080_1737630754371.png" alt="在这里插入图片描述"></p>
<h2 id="4-任务执行前后如何添加监听事件"><a href="#4-任务执行前后如何添加监听事件" class="headerlink" title="4.任务执行前后如何添加监听事件?"></a>4.任务执行前后如何添加监听事件?</h2><p>首先书写自己的监听事件:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作业监听器, 执行前后发送钉钉消息进行通知</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hfl</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageElasticJobListener</span> <span class="keyword">implements</span> <span class="title class_">ElasticJobListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeJobExecuted</span><span class="params">(ShardingContexts shardingContexts)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> date + <span class="string">&quot; 【五征定时任务-&quot;</span> + shardingContexts.getJobName() + <span class="string">&quot;】任务开始执行====&quot;</span> + JsonUtils.toJson(shardingContexts);</span><br><span class="line"><span class="comment">//        DingDingMessageUtil.sendTextMessage(msg);</span></span><br><span class="line">        System.out.println(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterJobExecuted</span><span class="params">(ShardingContexts shardingContexts)</span> &#123;</span><br><span class="line">    	<span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> date + <span class="string">&quot; 【五征定时任务-&quot;</span> + shardingContexts.getJobName() + <span class="string">&quot;】任务执行结束====&quot;</span> + JsonUtils.toJson(shardingContexts);</span><br><span class="line"><span class="comment">//        DingDingMessageUtil.sendTextMessage(msg);</span></span><br><span class="line">        System.out.println(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在配置文件中job参数上添加listener参数:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">elastic<span class="selector-class">.job</span><span class="selector-class">.MySimpleJob</span>.listener=com<span class="selector-class">.wuzheng</span><span class="selector-class">.job</span><span class="selector-class">.core</span><span class="selector-class">.MessageElasticJobListener</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/2412b34c27826589144fe8f2e44cb078_1737630754371.png" alt="在这里插入图片描述"></p>
<p>运行MySimpleJob看下执行结果:<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/f402c02f27d53709070fc4ad191cae06_1737630754371.png" alt="在这里插入图片描述"><br>可以看到任务前后执行了我们自己的逻辑.</p>
<h2 id="5-任务业务执行失败如何自定义异常处理"><a href="#5-任务业务执行失败如何自定义异常处理" class="headerlink" title="5.任务业务执行失败如何自定义异常处理?"></a>5.任务业务执行失败如何自定义异常处理?</h2><p>和监听器配置一样，第一步书写自定义异常，第二步配置job参数指定自定义异常类。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义异常处理，在任务异常时使用钉钉发送通知</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> <span class="variable">hfl</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomJobExceptionHandler</span> <span class="keyword">implements</span> <span class="title class_">JobExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Logger</span> logger = <span class="title class_">LoggerFactory</span>.<span class="title function_">getLogger</span>(<span class="title class_">CustomJobExceptionHandler</span>.<span class="property">class</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">handleException</span>(<span class="params"><span class="title class_">String</span> jobName, <span class="title class_">Throwable</span> cause</span>) &#123;</span><br><span class="line">        logger.<span class="title function_">error</span>(<span class="title class_">String</span>.<span class="title function_">format</span>(<span class="string">&quot;Job &#x27;%s&#x27; exception occur in job processing&quot;</span>, jobName), cause);</span><br><span class="line">        <span class="title class_">DingDingMessageUtil</span>.<span class="title function_">sendTextMessage</span>(<span class="string">&quot;【&quot;</span>+jobName+<span class="string">&quot;】任务异常。&quot;</span> + cause.<span class="title function_">getMessage</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>异常参数设置</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">elastic<span class="selector-class">.job</span><span class="selector-class">.MySimpleJob</span>.jobExceptionHandler=com<span class="selector-class">.wuzheng</span><span class="selector-class">.job</span><span class="selector-class">.core</span><span class="selector-class">.CustomJobExceptionHandler</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>我们自定义个异常测试下（System.out.println(2&#x2F;0);）</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@ElasticJobConf(<span class="type">name</span> = &quot;MySimpleJob&quot;)</span><br><span class="line"><span class="built_in">public</span> <span class="keyword">class</span> MySimpleJob implements SimpleJob &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	<span class="built_in">public</span> <span class="type">void</span> <span class="keyword">execute</span>(ShardingContext context) &#123;</span><br><span class="line">		<span class="keyword">System</span>.<span class="keyword">out</span>.println(<span class="number">2</span>/<span class="number">0</span>);</span><br><span class="line">		String shardParamter = context.getShardingParameter();</span><br><span class="line">		<span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;分片参数：&quot;+shardParamter);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">				String <span class="type">time</span> = <span class="built_in">new</span> SimpleDateFormat(&quot;HH:mm:ss&quot;).format(<span class="built_in">new</span> <span class="type">Date</span>());</span><br><span class="line">				<span class="keyword">System</span>.<span class="keyword">out</span>.println(<span class="type">time</span> + &quot;:开始执行简单任务&quot; + i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">```			</span><br><span class="line">看下效果：</span><br><span class="line"></span><br><span class="line">已经指向了我们自定义的异常的类及其类里面的异常处理逻辑代码：</span><br><span class="line">![在这里插入图片描述](https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/<span class="number">2025</span><span class="number">-1</span><span class="number">-13</span>/<span class="number">126</span>de654b196d25e6764566f3ed6978f_1737630754371.png)</span><br><span class="line"> ## <span class="number">6.</span>动态作业怎么实现?</span><br><span class="line">以上的定时任务基本都是这个流程:首先配置job参数，然后编写业务job，最后启动定时任务所在的微服务，这样该微服务下的所有定时任务job都统一注册进zookeeper注册中心了，然后自动就会启动这些定时任务。</span><br><span class="line">如果有个定时任务，不想微服务启动的时候让其启用，而是想动态的注册任务参数并控制何时启用。这个需求实现也很简单，我们封装的elastic-job的starter就已提供实现。</span><br><span class="line">自定义的starter提供了restful的<span class="number">2</span>个接口，一个注册任务接口: /job；一个删除任务接口:/job/remove?jobName=任务名。</span><br><span class="line">&gt; 首先书写自己的任务</span><br></pre></td></tr></table></figure>
<p>package com.wuzheng.job.demo.dynamic;</p>
<p>import com.dangdang.ddframe.job.api.ShardingContext;<br>import com.dangdang.ddframe.job.api.simple.SimpleJob;</p>
<p>&#x2F;**</p>
<ul>
<li>动态添加任务演示</li>
<li>@author hfl</li>
<li></li>
</ul>
<p> *&#x2F;<br>public class DynamicJob implements SimpleJob {</p>
<pre><code>@Override
public void execute(ShardingContext shardingContext) &#123;
	// 可以根据JobParameter来对不同的数据进行操作
	System.out.println(shardingContext.getJobParameter());
	System.out.println(shardingContext.getShardingParameter());
&#125;
</code></pre>
<p>}</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 置好之后，启动这个定时任务微服务项目并不会启用这个任务，因为我们没有任务参数，也没在job上加@ElasticJobConf注解，扫描不到这个任务，但是通过REST API可以动态的注册任务，API列表如下：</span><br><span class="line"></span><br><span class="line">/job</span><br><span class="line">添加任务是POST请求，数据格式为JSON体提交，格式如下：</span><br><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;jobName&quot;</span>:<span class="string">&quot;DynamicJob333&quot;</span>,</span><br><span class="line"><span class="string">&quot;cron&quot;</span>:<span class="string">&quot;0/10 * * * * ?&quot;</span>,</span><br><span class="line"><span class="string">&quot;jobType&quot;</span>:<span class="string">&quot;SIMPLE&quot;</span>,</span><br><span class="line"><span class="string">&quot;jobClass&quot;</span>:<span class="string">&quot;com.wuzheng.job.demo.dynamic.DynamicJob&quot;</span>,</span><br><span class="line"><span class="string">&quot;jobParameter&quot;</span>:<span class="string">&quot;2222222&quot;</span>,</span><br><span class="line"><span class="string">&quot;shardingTotalCount&quot;</span>:<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://gitee.com/hufanglei/elastic-job-learn/blob/master/spring-boot-elastic-job-starter/src/main/java/com/wuzheng/elasticjob/dynamic/bean/Job.java">点击查看完整字段地址</a></p>
<blockquote>
<p>注意：jobClass必须事先存在于服务中<br>使用postman测试:<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/f794e183a5564887dc94aa4660e0d3f3_1737630767645.png" alt="在这里插入图片描述"></p>
</blockquote>
<p>去控制台参看,显示已经成功注册到zookeeper中心，作业状态正常!<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/1003d19d583d869e4e79dcfc81c9a4dd_1737630767645.png" alt="在这里插入图片描述"></p>
<p>&#x2F;job&#x2F;remove 删除任务是GET请求，参数只要任务名称即可，比如：&#x2F;job&#x2F;remove?jobName&#x3D;任务名。可以用于任务完成之后清空注册中心的任务信息。</p>
<p>以上所有demo的源码下载地址请点击：<a target="_blank" rel="noopener" href="https://gitee.com/hufanglei/elastic-job-learn/tree/master/spring-boot-elastic-job-example">https://gitee.com/hufanglei/elastic-job-learn/tree/master/spring-boot-elastic-job-example</a>。</p>
<hr>
<p>个人微信公众号：<br>搜索： 怒放de每一天<br>不定时推送相关文章，期待和大家一起成长！！<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/undefined/img/2025-1-13/42409b1dbd9a6b7ff63471ea0769592d_1737631173950.png" alt="在这里插入图片描述"></p>
<hr>
<p>完</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hufanglei.github.io/2020/05/23/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%9C%BA%E6%99%AF%E5%92%8C%E6%9C%AC%E8%B4%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="胡方雷">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/23/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%9C%BA%E6%99%AF%E5%92%8C%E6%9C%AC%E8%B4%A8/" class="post-title-link" itemprop="url">适配器模式实战场景和本质</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-23 14:59:10" itemprop="dateCreated datePublished" datetime="2020-05-23T14:59:10+08:00">2020-05-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-24 11:37:59" itemprop="dateModified" datetime="2025-01-24T11:37:59+08:00">2025-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<p>@[toc]</p>
<h1 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h1><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/3d5891602ed8b03dda4655192280b2d6_1737630767645.png" alt="在这里插入图片描述"></p>
<p>适配器模式的应用场景:<br>适配器模式（Adapter Pattern）是指将一个类的接口转换成客户期望的另一个接口，使原本的接口不兼容的类可以一起工作，属于结构型设计模式。<br>适配器适用于以下几种业务场景：</p>
<ul>
<li>1、已经存在的类，它的方法和需求不匹配（方法结果相同或相似）的情况。</li>
<li>2、适配器模式不是软件设计阶段考虑的设计模式，是随着软件维护，由于不同产品、不同厂家造成功能类似而接口不相同情况下的解决方案。有点亡羊补牢的感觉。<br>生活中也非常的应用场景，例如电源插转换头、手机充电转换头、显示器转接头。</li>
</ul>
<h1 id="适配器模式入门小demo"><a href="#适配器模式入门小demo" class="headerlink" title="适配器模式入门小demo"></a>适配器模式入门小demo</h1><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/61ae3007e1d04c3f9e82ecd1d2fa1a32_1737630767645.png" alt="在这里插入图片描述"><br>适配的接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DC5</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">outputDC5V</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>被适配的接口&#x2F;类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AC220</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">outputAC220V</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">output</span> <span class="operator">=</span> <span class="number">220</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;输出交流电: &quot;</span> + output + <span class="string">&quot;v&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>适配类:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PowerAdapter</span> <span class="keyword">implements</span> <span class="title class_">DC5</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> AC220 ac220;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PowerAdapter</span><span class="params">(AC220 ac220)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ac220 = ac220;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">outputDC5V</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">adapterInput</span> <span class="operator">=</span> ac220.outputAC220V();</span><br><span class="line">        <span class="type">int</span> <span class="variable">adapetOutput</span> <span class="operator">=</span> adapterInput / <span class="number">44</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用PowerAdapter 输入AC: &quot;</span> + adapetOutput + <span class="string">&quot;V &quot;</span> + <span class="string">&quot;输出DC：&quot;</span> + adapetOutput + <span class="string">&quot;V&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> adapetOutput;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OjectAdapterTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DC5</span> <span class="variable">dc5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PowerAdapter</span>(<span class="keyword">new</span> <span class="title class_">AC220</span>());</span><br><span class="line">        dc5.outputDC5V();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/eae5f16413ccc9446f946bcd7952426e_1737630781031.png" alt="在这里插入图片描述"></p>
<h2 id="重构第三登录自由适配的业务场景"><a href="#重构第三登录自由适配的业务场景" class="headerlink" title="重构第三登录自由适配的业务场景"></a>重构第三登录自由适配的业务场景</h2><p>下面我们来一个实际的业务场景，利用适配模式来解决实际问题。年纪稍微大一点的小伙伴一定经历过这样一个过程。我们很早以前开发的老系统应该都有登录接口，但是随着业务的发展和社会的进步，单纯地依赖用户名密码登录显然不能满足用户需求了。现在，我们大部分系统都已经支持多种登录方式，如QQ 登录、微信登录、手机登录、微博登录等等，同时保留用户名密码的登录方式。虽然登录形式丰富了，但是登录后的处理逻辑可以不必改，同样是将登录状态保存到session，遵循开闭原则。</p>
<h3 id="简单的写法"><a href="#简单的写法" class="headerlink" title="简单的写法:"></a>简单的写法:</h3><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/4a7feb9f84205c04cc78dfc7d51b1362_1737630781031.png" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Title: ResultMsg</span></span><br><span class="line"><span class="comment"> * Description: 统一返回格式</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hfl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-05-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResultMsg</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ResultMsg</span><span class="params">(<span class="type">int</span> code, String msg, Object data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMsg</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(Object data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>登录参数:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Member</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String mid;</span><br><span class="line">    <span class="keyword">private</span> String info;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMid</span><span class="params">(String mid)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mid = mid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setInfo</span><span class="params">(String info)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.info = info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 最简单的 注册登录方式（被适配类Adaptee）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SiginService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">regist</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResultMsg</span>(<span class="number">200</span>, <span class="string">&quot;注册成功&quot;</span>, <span class="keyword">new</span> <span class="title class_">Member</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录的方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增第三方登录方式， </span></span><br><span class="line"><span class="comment"> * 兼容原来的注册登录(通过继承方式实现)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinginForThirdService</span> <span class="keyword">extends</span> <span class="title class_">SiginService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">loginForQQ</span><span class="params">(String openId)</span>&#123;</span><br><span class="line">        <span class="comment">//1、openId是全局唯一，我们可以把它当做是一个用户名(加长)</span></span><br><span class="line">        <span class="comment">//2、密码默认为QQ_EMPTY</span></span><br><span class="line">        <span class="comment">//3、注册（在原有系统里面创建一个用户）</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、调用原来的登录方法</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> loginForRegist(openId,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">loginForWechat</span><span class="params">(String openId)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">loginForToken</span><span class="params">(String token)</span>&#123;</span><br><span class="line">        <span class="comment">//通过token拿到用户信息，然后再重新登陆了一次</span></span><br><span class="line">        <span class="keyword">return</span>  <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">loginForTelphone</span><span class="params">(String telphone,String code)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">loginForRegist</span><span class="params">(String username,String password)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>.regist(username,<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.login(username,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>测试: 原来的用户名和密码登录 和现在新增的 通过qq和微信的方式都可以使用到。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SiginForThirdServiceTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SinginForThirdService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SinginForThirdService</span>();</span><br><span class="line">        service.login(<span class="string">&quot;tom&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        service.loginForQQ(<span class="string">&quot;sdfasdfasf&quot;</span>);</span><br><span class="line">        service.loginForWechat(<span class="string">&quot;sdfasfsa&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="优雅的写法"><a href="#优雅的写法" class="headerlink" title="优雅的写法"></a>优雅的写法</h3><p>上面的写法可以满足适配，但是，spring源码中采用更优雅的方式，我们也可以模仿下spring源码的方式，反射生成适配类 来实现这个需求:</p>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/0af3cf09a1e0ad9a7dfb5deb3a096259_1737630781031.png" alt="在这里插入图片描述"><br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/0665aa7226181a7e8e7e0e80f0c28439_1737630781031.png" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PassportForThirdAdapter</span> <span class="keyword">extends</span> <span class="title class_">SiginService</span> <span class="keyword">implements</span> <span class="title class_">IPassportForThird</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">loginForQQ</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> processLogin(id, LoginForQQAdapter.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">loginForWechat</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> processLogin(id, LoginForWechatAdapter.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">loginForToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> processLogin(token, LoginForTokenAdapter.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">loginForTelphone</span><span class="params">(String telphone, String code)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> processLogin(telphone, LoginForTelAdapter.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">loginForRegist</span><span class="params">(String username, String passport)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.regist(username, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.login(username, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这里用到了简单工厂模式及策略模式</span></span><br><span class="line">    <span class="keyword">private</span> ResultMsg <span class="title function_">processLogin</span><span class="params">(String key, Class&lt;? extends LoginAdapter&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">LoginAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> clazz.newInstance();</span><br><span class="line">            <span class="keyword">if</span> (adapter.support(adapter)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;传入参数是: key&quot;</span>+<span class="string">&quot;; 调用 &quot;</span>+adapter+<span class="string">&quot; 的login方法&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> adapter.login(key, adapter);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Title: IPassportForThird</span></span><br><span class="line"><span class="comment"> * Description: 第三方登录兼容接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hfl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-05-23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IPassportForThird</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * QQ 登录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResultMsg <span class="title function_">loginForQQ</span><span class="params">(String id)</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 微信登录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResultMsg <span class="title function_">loginForWechat</span><span class="params">(String id)</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 记住登录状态后自动登录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResultMsg <span class="title function_">loginForToken</span><span class="params">(String token)</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 手机号登录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> telphone</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResultMsg <span class="title function_">loginForTelphone</span><span class="params">(String telphone, String code)</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册后自动登录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> passport</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ResultMsg <span class="title function_">loginForRegist</span><span class="params">(String username, String passport)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LoginAdapter</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">support</span><span class="params">(Object adapter)</span>;</span><br><span class="line">    ResultMsg <span class="title function_">login</span><span class="params">(String id, Object adapter)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginForQQAdapter</span> <span class="keyword">implements</span> <span class="title class_">LoginAdapter</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">support</span><span class="params">(Object adapter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> adapter <span class="keyword">instanceof</span> LoginForQQAdapter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">login</span><span class="params">(String id, Object adapter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新浪微博登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginForSinaAdapter</span> <span class="keyword">implements</span> <span class="title class_">LoginAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">support</span><span class="params">(Object adapter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> adapter <span class="keyword">instanceof</span> LoginForSinaAdapter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">login</span><span class="params">(String id, Object adapter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginForTelAdapter</span> <span class="keyword">implements</span> <span class="title class_">LoginAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">support</span><span class="params">(Object adapter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span>  adapter <span class="keyword">instanceof</span> LoginForTelAdapter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">login</span><span class="params">(String id, Object adapter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Title: LoginForTokenAdapter</span></span><br><span class="line"><span class="comment"> * Description: token自动登录</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hfl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-05-23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginForTokenAdapter</span> <span class="keyword">implements</span> <span class="title class_">LoginAdapter</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">support</span><span class="params">(Object adapter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> adapter <span class="keyword">instanceof</span> LoginForTokenAdapter;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">login</span><span class="params">(String id, Object adapter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Title: LoginForWechatAdapter</span></span><br><span class="line"><span class="comment"> * Description: 微信登录</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hfl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-05-23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginForWechatAdapter</span>  <span class="keyword">implements</span> <span class="title class_">LoginAdapter</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">support</span><span class="params">(Object adapter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> adapter <span class="keyword">instanceof</span> LoginForWechatAdapter;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResultMsg <span class="title function_">login</span><span class="params">(String id, Object adapter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PassportTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">IPassportForThird</span> <span class="variable">passportForThird</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PassportForThirdAdapter</span>();</span><br><span class="line">        <span class="comment">//原来的接口 可用</span></span><br><span class="line">        passportForThird.loginForRegist(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        <span class="comment">//新增适配的接口 同样可用</span></span><br><span class="line">        passportForThird.loginForQQ(<span class="string">&quot;11&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>至此，我们在遵循开闭原则的前提下，完整地实现了一个兼容多平台登录的业务场景。<br>当然，我目前的这个设计也并不完美，仅供参考，感兴趣的小伙伴可以继续完善这段代<br>码。例如适配器中的参数目前是写死为String，改为Object[]应该更合理。</p>
</blockquote>
<h2 id="适配器的3种方式"><a href="#适配器的3种方式" class="headerlink" title="适配器的3种方式"></a>适配器的3种方式</h2><p>1.类适配器<br>2.对象适配器器<br>3.接口适配器<br>之前的一篇适配的文章有提到。</p>
<h2 id="适配器模式的本质"><a href="#适配器模式的本质" class="headerlink" title="适配器模式的本质"></a>适配器模式的本质</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/d31593c22ca71513e39e6fe5b1ba547f_1737630781031.png" alt="在这里插入图片描述"></p>
<h2 id="什么时候使用适配器模式"><a href="#什么时候使用适配器模式" class="headerlink" title="什么时候使用适配器模式"></a>什么时候使用适配器模式</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/0b4911c94dfaa2ae1053eca16d0172ef_1737630793808.png" alt="在这里插入图片描述"></p>
<h2 id="相关模式"><a href="#相关模式" class="headerlink" title="相关模式"></a>相关模式</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/38b536e5a7de812aa58a8c6ffa7c3b1f_1737630793808.png" alt="在这里插入图片描述"><br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/f299a501c74608c3bcb8883f32bcbbe9_1737630793808.png" alt="在这里插入图片描述"></p>
<hr>
<p>个人微信公众号：<br>搜索： 怒放de每一天<br>不定时推送相关文章，期待和大家一起成长！！<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/undefined/img/2025-1-13/42409b1dbd9a6b7ff63471ea0769592d_1737631173950.png" alt="在这里插入图片描述"></p>
<hr>
<p>完</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hufanglei.github.io/2020/05/23/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0%E5%B0%81%E8%A3%85jdbc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="胡方雷">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/23/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E5%AE%9E%E7%8E%B0%E5%B0%81%E8%A3%85jdbc/" class="post-title-link" itemprop="url">模板方法模式实现封装jdbc</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-23 14:00:43" itemprop="dateCreated datePublished" datetime="2020-05-23T14:00:43+08:00">2020-05-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-24 11:37:59" itemprop="dateModified" datetime="2025-01-24T11:37:59+08:00">2025-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<p>@[toc]</p>
<h1 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h1><h2 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/14747c805d803c343f8a7ec93df9fcd3_1737630793808.png" alt="在这里插入图片描述"><br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/bad4665ba2e82fdea0dd182053285894_1737630807640.png" alt="在这里插入图片描述"></p>
<h2 id="实践1：各个课程流程-求同存异-写法"><a href="#实践1：各个课程流程-求同存异-写法" class="headerlink" title="实践1：各个课程流程 求同存异 写法"></a>实践1：各个课程流程 求同存异 写法</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/8cf8cd83e06b0967896d2dc94d5ed044_1737630807640.png" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模板会有一个或者多个未现实方法，</span></span><br><span class="line"><span class="comment"> * 而且这几个未实现方法有固定的执行顺序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">NetWorkCourse</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">createCourse</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1、发布预习资料</span></span><br><span class="line">        <span class="built_in">this</span>.postPreResource();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、制作PPT课件</span></span><br><span class="line">        <span class="built_in">this</span>.createPPT();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、在线直播</span></span><br><span class="line">        <span class="built_in">this</span>.liveVideo();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、提交课件、课堂笔记</span></span><br><span class="line">        <span class="built_in">this</span>.postNote();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5、提交源码</span></span><br><span class="line">        <span class="built_in">this</span>.postSource();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6、布置作业，有些课是没有作业，有些课是有作业的</span></span><br><span class="line">        <span class="comment">//如果有作业的话，检查作业，如果没作业，完成了</span></span><br><span class="line">        <span class="keyword">if</span> (needHomework()) &#123;</span><br><span class="line">            checkHomework();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">checkHomework</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//钩子方法：实现流程的微调</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">needHomework</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">postSource</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;提交源代码&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">postNote</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;提交课件和笔记&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">liveVideo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;直播授课&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">createPPT</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;创建备课PPT&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">postPreResource</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;分发预习资料&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BigDataCource</span> <span class="keyword">extends</span> <span class="title class_">NetWorkCourse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">needHomeworkFlag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BigDataCource</span><span class="params">(<span class="type">boolean</span> needHomeworkFlag)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.needHomeworkFlag = needHomeworkFlag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">checkHomework</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;检查大数据的课后作业&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">needHomework</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.needHomeworkFlag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaCourse</span> <span class="keyword">extends</span> <span class="title class_">NetWorkCourse</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">checkHomework</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;检查Java的架构课件&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>测试NetWorkCourseTest</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NetWorkCourseTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;---检查java作业--&quot;</span>);</span><br><span class="line">        <span class="type">NetWorkCourse</span> <span class="variable">javaCourse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JavaCourse</span>();</span><br><span class="line">        javaCourse.createCourse();</span><br><span class="line">        System.out.println(<span class="string">&quot;---检查大数据作业--&quot;</span>);</span><br><span class="line">        <span class="type">BigDataCource</span> <span class="variable">bigDataCource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDataCource</span>(<span class="literal">true</span>);</span><br><span class="line">        bigDataCource.createCourse();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/628c6b4cdfc0be4f9141aa8e4bf89fc2_1737630807640.png" alt="在这里插入图片描述"><br>可以看到java课程和大数据课程不同的作业，选择实现。相同的逻辑，父类给 实现了。</p>
<h2 id="实践2：使用模板方法模式封装jdbc"><a href="#实践2：使用模板方法模式封装jdbc" class="headerlink" title="实践2：使用模板方法模式封装jdbc"></a>实践2：使用模板方法模式封装jdbc</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/fe76efa39bbf46c3584dce080b0215e4_1737630807640.png" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">JdbcTemplate</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JdbcTemplate</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dataSource = dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;?&gt; executeQuery(String sql, RowMapper&lt;?&gt; rowMapper, Object[] values) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1、获取连接</span></span><br><span class="line">            <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="built_in">this</span>.getConnection();</span><br><span class="line">            <span class="comment">//2、创建语句集</span></span><br><span class="line">            <span class="type">PreparedStatement</span> <span class="variable">pstm</span> <span class="operator">=</span> <span class="built_in">this</span>.createPrepareStatement(conn, sql);</span><br><span class="line">            <span class="comment">//3、执行语句集</span></span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="built_in">this</span>.executeQuery(pstm, values);</span><br><span class="line">            <span class="comment">//4、处理结果集</span></span><br><span class="line">            List&lt;?&gt; result = <span class="built_in">this</span>.paresResultSet(rs, rowMapper);</span><br><span class="line">            <span class="comment">//5、关闭结果集</span></span><br><span class="line">            <span class="built_in">this</span>.closeResultSet(rs);</span><br><span class="line">            <span class="comment">//6、关闭语句集</span></span><br><span class="line">            <span class="built_in">this</span>.closeStatement(pstm);</span><br><span class="line">            <span class="comment">//7、关闭连接</span></span><br><span class="line">            <span class="built_in">this</span>.closeConnection(conn);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1、获取连接</span></span><br><span class="line">    <span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.dataSource.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2、创建语句集</span></span><br><span class="line">    <span class="keyword">protected</span> PreparedStatement <span class="title function_">createPrepareStatement</span><span class="params">(Connection conn, String sql)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> conn.prepareStatement(sql);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3、执行语句集</span></span><br><span class="line">    <span class="keyword">protected</span> ResultSet <span class="title function_">executeQuery</span><span class="params">(PreparedStatement pstm, Object[] values)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; values.length; i++) &#123;</span><br><span class="line">            pstm.setObject(i,values[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pstm.executeQuery();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4、处理结果集</span></span><br><span class="line">    <span class="keyword">protected</span> List&lt;?&gt; paresResultSet(ResultSet rs, RowMapper&lt;?&gt; rowMapper) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        List&lt;Object&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Object&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">rowNum</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (rs.next())&#123;</span><br><span class="line">            result.add(rowMapper.mapRow(rs,rowNum ++));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5、关闭结果集</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">closeResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        rs.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6、关闭语句集</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">closeStatement</span><span class="params">(PreparedStatement pstm)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        pstm.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//7、关闭连接</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">closeConnection</span><span class="params">(Connection conn)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//数据库连接池，我们不是关闭</span></span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Member</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String addr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getNickname</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> nickname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNickname</span><span class="params">(String nickname)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nickname = nickname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> addr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddr</span><span class="params">(String addr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.addr = addr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Title: RowMapper</span></span><br><span class="line"><span class="comment"> * Description: TODO</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hfl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-05-20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RowMapper</span>&lt;T&gt; &#123;</span><br><span class="line">    T <span class="title function_">mapRow</span><span class="params">(ResultSet rs, <span class="type">int</span> rowNum)</span><span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberDao</span> <span class="keyword">extends</span> <span class="title class_">JdbcTemplate</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MemberDao</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;?&gt; selectAll()&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from t_member&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.executeQuery(sql, <span class="keyword">new</span> <span class="title class_">RowMapper</span>&lt;Member&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Member <span class="title function_">mapRow</span><span class="params">(ResultSet rs, <span class="type">int</span> rowNum)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                <span class="type">Member</span> <span class="variable">member</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Member</span>();</span><br><span class="line">                <span class="comment">//字段过多，原型模式</span></span><br><span class="line">                member.setUsername(rs.getString(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">                member.setPassword(rs.getString(<span class="string">&quot;password&quot;</span>));</span><br><span class="line">                member.setAge(rs.getInt(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">                member.setAddr(rs.getString(<span class="string">&quot;addr&quot;</span>));</span><br><span class="line">                <span class="keyword">return</span> member;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberDaoTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MemberDao</span> <span class="variable">memberDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MemberDao</span>(<span class="literal">null</span>);</span><br><span class="line">        List&lt;?&gt; result = memberDao.selectAll();</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>继续总结下模板方法模式:</p>
<h2 id="好莱坞法则"><a href="#好莱坞法则" class="headerlink" title="好莱坞法则"></a>好莱坞法则</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/92d8ea9a0479ce5f5bb0cd251647ab03_1737630807640.png" alt="在这里插入图片描述"></p>
<h2 id="模板方法模式的本质"><a href="#模板方法模式的本质" class="headerlink" title="模板方法模式的本质"></a>模板方法模式的本质</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/524cf7b7a7577da4d833d27a7a61bab9_1737630820349.png" alt="在这里插入图片描述"><br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/7413ef540c238c1dfdad109974acd05b_1737630820349.png" alt="在这里插入图片描述"></p>
<h2 id="什么时候用到模板方法模式"><a href="#什么时候用到模板方法模式" class="headerlink" title="什么时候用到模板方法模式"></a>什么时候用到模板方法模式</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/b63e0eae90c0eb1d6e7a2cb563c65310_1737630820349.png" alt="在这里插入图片描述"></p>
<h2 id="相关模式对比说明"><a href="#相关模式对比说明" class="headerlink" title="相关模式对比说明"></a>相关模式对比说明</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/f41647d3377a0be76e67c2b748ff9997_1737630820349.png" alt="在这里插入图片描述"></p>
<p>代码地址:<br><a target="_blank" rel="noopener" href="https://github.com/hufanglei/pattern-learn/tree/master/src/main/java/com/example/template">https://github.com/hufanglei/pattern-learn/tree/master/src/main/java/com/example/template</a></p>
<hr>
<p>个人微信公众号：<br>搜索： 怒放de每一天<br>不定时推送相关文章，期待和大家一起成长！！<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/undefined/img/2025-1-13/42409b1dbd9a6b7ff63471ea0769592d_1737631173950.png" alt="在这里插入图片描述"></p>
<hr>
<p>完</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hufanglei.github.io/2020/05/22/excel%20VBA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%8C%E8%87%AA%E5%AE%9A%E4%B9%89excel%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90sql%E8%AF%AD%E5%8F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="胡方雷">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/22/excel%20VBA%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%EF%BC%8C%E8%87%AA%E5%AE%9A%E4%B9%89excel%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E6%9D%BF%E7%94%9F%E6%88%90sql%E8%AF%AD%E5%8F%A5/" class="post-title-link" itemprop="url">excel VBA编程入门，自定义excel数据库模板生成sql语句</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-22 22:07:42" itemprop="dateCreated datePublished" datetime="2020-05-22T22:07:42+08:00">2020-05-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-24 11:37:59" itemprop="dateModified" datetime="2025-01-24T11:37:59+08:00">2025-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/java%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">java基础</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<p>@[toc]</p>
<blockquote>
<p>最近公司有个需求，提前让数据库表结构在excel模板中设计，然后再建对应的数据库DB。字段少好说，无脑录入即可，但是，我遇到个100多个字段的，实在忍不了，最终入门了VBA编程，自己写脚本生成了sql语句。减少了需要无用重复劳动。</p>
</blockquote>
<h1 id="VBA基础"><a href="#VBA基础" class="headerlink" title="VBA基础"></a>VBA基础</h1><p>首先学习下vba的基础。</p>
<h1 id="一-了解VBA"><a href="#一-了解VBA" class="headerlink" title="一.了解VBA"></a>一.了解VBA</h1><h2 id="1-进入vba"><a href="#1-进入vba" class="headerlink" title="1.进入vba"></a>1.进入vba</h2><blockquote>
<p>alt + f11</p>
<p>文件 - 选项 - 自定义功能区 - 勾选开发工具</p>
</blockquote>
<h2 id="2-认识宏"><a href="#2-认识宏" class="headerlink" title="2.认识宏"></a>2.认识宏</h2><ul>
<li><p>录制宏</p>
</li>
<li><p>使用相对应用录制宏</p>
</li>
</ul>
<h1 id="二-VBA编程"><a href="#二-VBA编程" class="headerlink" title="二. VBA编程"></a>二. VBA编程</h1><h2 id="1-hello-world"><a href="#1-hello-world" class="headerlink" title="1.hello world"></a>1.hello world</h2><p>双击某个sheet页, 把鼠标放在 窗口里面，点击工具栏的插入，选择过程，随便起个过程名，比如 class就生成了代码:</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Public</span> <span class="keyword">Sub</span> <span class="keyword">class</span>()</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

<p>写个hello world程序:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Sub <span class="title function_">class</span><span class="params">()</span></span><br><span class="line">    Dim <span class="type">name</span></span><br><span class="line">    <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">    name = <span class="string">&quot;胡老师好&quot;</span></span><br><span class="line">    MsgBox name    </span><br><span class="line">End Sub</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/c67fc50242c1ffb521958ed3ff2b8e6f_1737630834259.png" alt="在这里插入图片描述"></p>
<h2 id="2-调出立即窗口和本地窗口"><a href="#2-调出立即窗口和本地窗口" class="headerlink" title="2.调出立即窗口和本地窗口"></a>2.调出立即窗口和本地窗口</h2><p>在工具栏中选择 选择立即窗口，和本地窗口。<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/b4705d2119ff65c9dc43474417922736_1737630834259.png" alt="在这里插入图片描述"></p>
<h2 id="3-debug显示"><a href="#3-debug显示" class="headerlink" title="3.debug显示"></a>3.debug显示</h2><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> <span class="keyword">class</span>()</span><br><span class="line">    <span class="keyword">Dim</span> name</span><br><span class="line">    name = <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">    Debug.Print name</span><br><span class="line">    name = <span class="string">&quot;胡老师好&quot;</span></span><br><span class="line">    MsgBox name</span><br><span class="line">    Debug.Print name</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/c8550000803f5ab716525c25d19a5318_1737630834259.png" alt="在这里插入图片描述"></p>
<h2 id="4-注释"><a href="#4-注释" class="headerlink" title="4.注释"></a>4.注释</h2><p>注释有2种形式，一种是rem。一种是  ‘ (单引号)</p>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/0f7e98671ff843384d38b72a47acbf06_1737630834259.png" alt="在这里插入图片描述"></p>
<h2 id="5-数据类型"><a href="#5-数据类型" class="headerlink" title="5.数据类型"></a>5.数据类型</h2><p>variant 代表任意类型</p>
<p>single double decimal 代表 小数、</p>
<p>rem 代表注释关键字</p>
<p>Const 常量关键字</p>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/f007969d1515c1435ebc5d78a06084af_1737630834259.png" alt="在这里插入图片描述"><br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/e3be707d769a927196cee7f6cfad3918_1737630845995.png" alt="在这里插入图片描述"></p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> <span class="keyword">class</span>()</span><br><span class="line">   <span class="comment"> Rem variant是任意类型</span></span><br><span class="line">    <span class="keyword">Dim</span> name <span class="keyword">As</span> Variant</span><br><span class="line">    name = <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">   <span class="comment"> Rem debug</span></span><br><span class="line">    Debug.Print name</span><br><span class="line">    name = <span class="string">&quot;胡老师好&quot;</span></span><br><span class="line">    Debug.Print name</span><br><span class="line">   <span class="comment"> Rem 定义常量</span></span><br><span class="line">    <span class="keyword">Const</span> num <span class="keyword">As</span> <span class="type">Integer</span> = <span class="number">123</span></span><br><span class="line">    Debug.Print num</span><br><span class="line">    </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="5-变量的生命周期和定义域"><a href="#5-变量的生命周期和定义域" class="headerlink" title="5.变量的生命周期和定义域"></a>5.变量的生命周期和定义域</h2><ul>
<li>定义域: public 和 private<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/d30cbcfc321f2b2a59e686adbf383114_1737630845995.png" alt="在这里插入图片描述"></li>
<li>static 是静态变量</li>
</ul>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> class1()</span><br><span class="line"><span class="keyword">Dim</span> x <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line"><span class="comment">Rem static 是静态变量</span></span><br><span class="line"><span class="keyword">Static</span> y <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">x = x + <span class="number">1</span></span><br><span class="line">y = y + <span class="number">1</span></span><br><span class="line">Debug.Print <span class="string">&quot;x=&quot;</span> &amp; x</span><br><span class="line">Debug.Print <span class="string">&quot;y=&quot;</span> &amp; y</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

<h2 id="6-判断语句"><a href="#6-判断语句" class="headerlink" title="6.判断语句"></a>6.判断语句</h2><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> class3()</span><br><span class="line"><span class="keyword">Dim</span> number <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">number = <span class="number">1</span></span><br><span class="line"><span class="keyword">If</span> number &gt; <span class="number">100</span> <span class="keyword">Then</span></span><br><span class="line">   Debug.Print <span class="string">&quot;优秀&quot;</span></span><br><span class="line"><span class="keyword">ElseIf</span> number &gt; <span class="number">95</span> <span class="keyword">Then</span></span><br><span class="line">   Debug.Print <span class="string">&quot;良好&quot;</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">  Debug.Print <span class="string">&quot;一般&quot;</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

<h2 id="7-不等于-switch-case-条件判断"><a href="#7-不等于-switch-case-条件判断" class="headerlink" title="7.不等于&lt;&gt; ,  switch case 条件判断"></a>7.不等于&lt;&gt; ,  switch case 条件判断</h2><ul>
<li>&lt;&gt; 不等于</li>
</ul>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> class3()</span><br><span class="line"><span class="keyword">Dim</span> number <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">number = <span class="string">&quot;匹配&quot;</span></span><br><span class="line"><span class="keyword">If</span> number &gt; <span class="string">&quot;匹配&quot;</span> <span class="keyword">Then</span></span><br><span class="line">   Debug.Print <span class="string">&quot;优秀&quot;</span></span><br><span class="line"><span class="keyword">ElseIf</span> number &lt;&gt; <span class="string">&quot;匹配&quot;</span> <span class="keyword">Then</span></span><br><span class="line">   Debug.Print <span class="string">&quot;良好&quot;</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>switch case</li>
</ul>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">Sub</span> class4()</span><br><span class="line">    <span class="keyword">Dim</span> number <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    number = <span class="string">&quot;匹配&quot;</span></span><br><span class="line">    <span class="keyword">Select</span> <span class="keyword">Case</span> number</span><br><span class="line">      <span class="keyword">Case</span> <span class="string">&quot;匹配&quot;</span></span><br><span class="line">        Debug.Print <span class="string">&quot;匹配&quot;</span></span><br><span class="line">      <span class="keyword">Case</span> <span class="string">&quot;不匹配&quot;</span></span><br><span class="line">        Debug.Print <span class="string">&quot;不匹配&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">Select</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>boolean类型的使用</li>
</ul>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> class5()</span><br><span class="line">    <span class="keyword">Dim</span> count <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    <span class="keyword">Dim</span> if_f <span class="keyword">As</span> <span class="type">Boolean</span></span><br><span class="line">    count = <span class="number">11</span></span><br><span class="line">    if_f = (count = <span class="number">10</span>)</span><br><span class="line">    MsgBox if_f</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

<h2 id="8-循环"><a href="#8-循环" class="headerlink" title="8.循环"></a>8.循环</h2><ul>
<li>最简单的循环</li>
</ul>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> <span class="keyword">class</span>()</span><br><span class="line"><span class="comment">Rem 演示循环</span></span><br><span class="line"><span class="keyword">Dim</span> count <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    <span class="keyword">For</span> count = <span class="number">1</span> <span class="keyword">To</span> <span class="number">10</span></span><br><span class="line">        Debug.Print count</span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line">        Debug.Print <span class="string">&quot;count 循环结束之后的值是 &quot;</span> &amp; count</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/514391df9260d8e1a3372bfd049bf736_1737630845995.png" alt="在这里插入图片描述"></p>
<ul>
<li><p>循环控制单元格属性</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> <span class="keyword">class</span>()</span><br><span class="line"><span class="comment">Rem 演示循环</span></span><br><span class="line"><span class="keyword">Dim</span> count <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    <span class="keyword">For</span> count = <span class="number">2</span> <span class="keyword">To</span> <span class="number">10</span></span><br><span class="line">        <span class="keyword">If</span> count <span class="built_in">Mod</span> <span class="number">2</span> = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">           <span class="comment"> Rem rang函数代表选中的某列单元格</span></span><br><span class="line">           <span class="comment"> Rem Interior代表单元格内部的对象</span></span><br><span class="line">            Range(<span class="string">&quot;T&quot;</span> &amp; count).Interior.ColorIndex = <span class="number">1</span></span><br><span class="line">        <span class="keyword">Else</span></span><br><span class="line">            Range(<span class="string">&quot;T&quot;</span> &amp; count).Interior.ColorIndex = <span class="number">3</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">     <span class="keyword">Next</span></span><br><span class="line">     Debug.Print <span class="string">&quot;count 循环结束之后的值是 &quot;</span> &amp; count</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/14d4d8cc4925292679f87c16b29bc017_1737630845995.png" alt="在这里插入图片描述"></p>
<ul>
<li><p>循环控制单元格求和</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> <span class="keyword">class</span>()</span><br><span class="line"><span class="comment">Rem 演示循环</span></span><br><span class="line"><span class="keyword">Dim</span> COUNT <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line"><span class="keyword">Dim</span> score <span class="keyword">As</span> <span class="type">Double</span></span><br><span class="line"><span class="keyword">For</span> COUNT = <span class="number">2</span> <span class="keyword">To</span> <span class="number">20</span></span><br><span class="line">   <span class="comment"> Rem cells的参数 第一个参数代表横行，第2个参数代表竖行</span></span><br><span class="line">    Cells(COUNT, <span class="number">8</span>) = <span class="string">&quot;=sum(rc[-1]:rc[-6])&quot;</span></span><br><span class="line"><span class="keyword">Next</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/7543edb2f6d8a42ba8909bf7ce2e02cb_1737630845995.png" alt="在这里插入图片描述"></p>
<ul>
<li>循环单元格操作+if</li>
</ul>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> <span class="keyword">class</span>()</span><br><span class="line"><span class="comment">Rem 演示循环</span></span><br><span class="line"><span class="keyword">Dim</span> COUNT <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line"><span class="keyword">Dim</span> score <span class="keyword">As</span> <span class="type">Double</span></span><br><span class="line"><span class="keyword">For</span> COUNT = <span class="number">2</span> <span class="keyword">To</span> <span class="number">20</span></span><br><span class="line">   <span class="comment"> Rem cells的参数 第一个参数代表横行，第2个参数代表竖行</span></span><br><span class="line">    Cells(COUNT, <span class="number">8</span>) = <span class="string">&quot;=sum(rc[-1]:rc[-6])&quot;</span></span><br><span class="line">    score = Cells(COUNT, <span class="number">8</span>)</span><br><span class="line">    <span class="keyword">If</span> score &gt; <span class="number">700</span> <span class="keyword">Then</span></span><br><span class="line">        Cells(COUNT, <span class="number">9</span>) = <span class="string">&quot;秀儿&quot;</span></span><br><span class="line">    <span class="keyword">ElseIf</span> score &gt; <span class="number">650</span> <span class="keyword">Then</span></span><br><span class="line">        Cells(COUNT, <span class="number">9</span>) = <span class="string">&quot;良好&quot;</span></span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">       Cells(COUNT, <span class="number">9</span>) = <span class="string">&quot;小垃圾&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">Next</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/5923be3813997c804e2dcfa6c42f1cd1_1737630860895.png" alt="在这里插入图片描述"></p>
<h3 id="do-while"><a href="#do-while" class="headerlink" title="do while"></a>do while</h3><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> <span class="keyword">class</span>()</span><br><span class="line">   <span class="comment"> Rem do while 演示</span></span><br><span class="line">    <span class="keyword">Dim</span> count <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    count = <span class="number">20</span></span><br><span class="line">    <span class="keyword">Do</span> <span class="keyword">While</span> count &gt; <span class="number">10</span></span><br><span class="line">        Debug.Print count</span><br><span class="line">        count = count - <span class="number">1</span></span><br><span class="line">        Debug.Print count</span><br><span class="line">    <span class="keyword">Loop</span></span><br><span class="line">    </span><br><span class="line">   <span class="comment"> Rem do .. loop 条件 不演示了</span></span><br><span class="line">     <span class="keyword">Do</span>        </span><br><span class="line">    <span class="keyword">Loop</span> <span class="keyword">While</span> count &gt; <span class="number">10</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/9d41bde57384bdcef6f3275f75f0f5b0_1737630860895.png" alt="在这里插入图片描述"></p>
<h3 id="退出循环的语句-exit-for"><a href="#退出循环的语句-exit-for" class="headerlink" title="退出循环的语句  exit for"></a>退出循环的语句  exit for</h3><blockquote>
<p>使用for循环的时候退出用   exit for</p>
</blockquote>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> class1()</span><br><span class="line">    <span class="keyword">Dim</span> count <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    <span class="keyword">For</span> count = <span class="number">1</span> <span class="keyword">To</span> <span class="number">10</span></span><br><span class="line">        <span class="keyword">If</span> count = <span class="number">5</span> <span class="keyword">Then</span></span><br><span class="line">            Debug.Print <span class="string">&quot;count 退出循环的值是: &quot;</span> &amp; count</span><br><span class="line">            <span class="keyword">Exit</span> <span class="keyword">For</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">        Debug.Print count</span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/192d1ae99ae31b589ec37546fbbcbbb9_1737630860895.png" alt="在这里插入图片描述"></p>
<h3 id="退出循环的语句-exit-do"><a href="#退出循环的语句-exit-do" class="headerlink" title="退出循环的语句  exit do"></a>退出循环的语句  exit do</h3><blockquote>
<p>使用fo while循环的时候退出用    exit do</p>
</blockquote>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> class1()</span><br><span class="line">    <span class="keyword">Dim</span> count <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    <span class="keyword">Do</span> <span class="keyword">While</span> <span class="literal">True</span></span><br><span class="line">        count = count + <span class="number">1</span></span><br><span class="line">        <span class="keyword">If</span> count &gt; <span class="number">5</span> <span class="keyword">Then</span></span><br><span class="line">            Debug.Print <span class="string">&quot;此时退出循环的值是: &quot;</span> &amp; count</span><br><span class="line">            <span class="keyword">Exit</span> <span class="keyword">Do</span></span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">Loop</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/ed16dc948956d389a03bc14a03242884_1737630860895.png" alt="在这里插入图片描述"></p>
<h2 id="9-数组"><a href="#9-数组" class="headerlink" title="9.数组"></a>9.数组</h2><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> <span class="keyword">class</span>()</span><br><span class="line">  <span class="keyword">Dim</span> arr(<span class="number">2</span>) <span class="keyword">As</span> Variant</span><br><span class="line">  <span class="keyword">Dim</span> i <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">  arr(<span class="number">0</span>) = <span class="string">&quot;小明&quot;</span></span><br><span class="line">  arr(<span class="number">1</span>) = <span class="number">2</span></span><br><span class="line">  arr(<span class="number">2</span>) = <span class="literal">True</span></span><br><span class="line">  <span class="keyword">For</span> i = <span class="number">0</span> <span class="keyword">To</span> <span class="number">2</span></span><br><span class="line">    Debug.Print arr(i)</span><br><span class="line">  <span class="keyword">Next</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/0fe91f8b2dc0a9bee65cca5c0d0f8f93_1737630860895.png" alt="在这里插入图片描述"></p>
<ul>
<li><p>下标越界</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> <span class="keyword">class</span>()</span><br><span class="line"> <span class="comment">&#x27; Const i As Integer = 10</span></span><br><span class="line"> <span class="comment">&#x27; Dim arr(i) As Variant</span></span><br><span class="line"> <span class="comment"> Rem  可以指明数组的范围奥 起始开始限制了也是下标越界</span></span><br><span class="line">  <span class="keyword">Dim</span> arr(<span class="number">2</span> <span class="keyword">To</span> <span class="number">5</span>) <span class="keyword">As</span> Variant</span><br><span class="line">  arr(<span class="number">1</span>) = <span class="number">1</span></span><br><span class="line">  Debug.Print arr(<span class="number">1</span>)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span> </span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/da2f47251ee3cc7b9308e6ec8265ab4c_1737630870901.png" alt="在这里插入图片描述"></p>
<h1 id="10-二维数组"><a href="#10-二维数组" class="headerlink" title="10.二维数组"></a>10.二维数组</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Sub <span class="title function_">class</span><span class="params">()</span></span><br><span class="line">    Dim <span class="title function_">arr</span><span class="params">(<span class="number">2</span> To <span class="number">5</span>, <span class="number">3</span> To <span class="number">6</span>)</span> As Variant</span><br><span class="line">      <span class="title function_">arr</span><span class="params">(<span class="number">2</span>, <span class="number">3</span>)</span> = <span class="number">1</span></span><br><span class="line">      Debug.Print <span class="title function_">arr</span><span class="params">(<span class="number">2</span>, <span class="number">3</span>)</span></span><br><span class="line">End Sub </span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/0568446e22e66b0d9d8f11259f1b586c_1737630870901.png" alt="在这里插入图片描述"></p>
<ul>
<li><p>遍历循环</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Sub <span class="title function_">class</span><span class="params">()</span></span><br><span class="line">    Dim <span class="title function_">arr</span><span class="params">(<span class="number">2</span> To <span class="number">5</span>, <span class="number">3</span> To <span class="number">6</span>)</span> As Variant</span><br><span class="line">      <span class="title function_">arr</span><span class="params">(<span class="number">2</span>, <span class="number">3</span>)</span> = <span class="number">1</span></span><br><span class="line">      <span class="string">&#x27;Debug.Print arr(2, 3)</span></span><br><span class="line"><span class="string">      For x = 2 To 5</span></span><br><span class="line"><span class="string">        For y = 3 To 6</span></span><br><span class="line"><span class="string">            Debug.Print arr(2, 3)</span></span><br><span class="line"><span class="string">        Next</span></span><br><span class="line"><span class="string">      Next</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">End Sub </span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/c55631077ea95e2c48c1441f83d484d4_1737630870901.png" alt="在这里插入图片描述"></p>
<h2 id="11-操作单元格"><a href="#11-操作单元格" class="headerlink" title="11.操作单元格"></a>11.操作单元格</h2><p>2中方式，一种是range，一种是cells</p>
<p>range<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/34a20a49c7a9d44236d888752d12d49e_1737630870901.png" alt="在这里插入图片描述"></p>
<p>cells<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/46a39c35472656dc9038dc4fcf98a0a0_1737630870901.png" alt="在这里插入图片描述"></p>
<h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><blockquote>
<p>现在掌握了上面的基础知识，基本上可以满足我们最开始的需求<br>解决思路:  <code>循环方式获取单元格中的内容，拼接成 sql 的创建脚本语句即可</code>。</p>
</blockquote>
<h1 id="自定义vba脚本生成sql"><a href="#自定义vba脚本生成sql" class="headerlink" title="自定义vba脚本生成sql"></a>自定义vba脚本生成sql</h1><ul>
<li>原来的excel模板内容:<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/9063fcc100fbbeab3120cfa816d84d5f_1737630881461.png" alt="在这里插入图片描述"></li>
<li>目标:输出sql创建表的语句:<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/4be01e845cb1e152dad084c7f9a69c63_1737630881461.png" alt="在这里插入图片描述"><br>具体实现的脚本:</li>
</ul>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Public</span> <span class="keyword">Sub</span> <span class="keyword">class</span>()</span><br><span class="line">   <span class="comment"> Rem 声明字段row的开始行号</span></span><br><span class="line">    <span class="keyword">Const</span> startRow <span class="keyword">As</span> <span class="type">Integer</span> = <span class="number">13</span></span><br><span class="line">   <span class="comment"> Rem 声明字段row的结束行号</span></span><br><span class="line">    <span class="keyword">Const</span> endRow <span class="keyword">As</span> <span class="type">Integer</span> = <span class="number">28</span></span><br><span class="line">   <span class="comment"> Rem 声明表名</span></span><br><span class="line">    <span class="keyword">Dim</span> tableName  <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    tableName = Range(<span class="string">&quot;E&quot;</span> &amp; <span class="number">6</span>)</span><br><span class="line">   <span class="comment"> Rem 声明主键</span></span><br><span class="line">    <span class="keyword">Dim</span> primaryKey  <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    primaryKey = Range(<span class="string">&quot;F&quot;</span> &amp; <span class="number">13</span>)</span><br><span class="line">   <span class="comment"> Rem 声明表名注释</span></span><br><span class="line">    <span class="keyword">Dim</span> tableComment <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    tableComment = Range(<span class="string">&quot;E&quot;</span> &amp; <span class="number">7</span>)</span><br><span class="line">   <span class="comment"> Rem 声明字段名对应列 英文序号</span></span><br><span class="line">    <span class="keyword">Dim</span> filedMetaNo <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    filedMetaNo = <span class="string">&quot;F&quot;</span></span><br><span class="line">   <span class="comment"> Rem 声明字段注释对应对应列 英文序号</span></span><br><span class="line">    <span class="keyword">Dim</span> commentMetaNo <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    commentMetaNo = <span class="string">&quot;C&quot;</span></span><br><span class="line">   <span class="comment"> Rem 声明字段备注 对应列的 英文序号</span></span><br><span class="line">    <span class="keyword">Dim</span> comment2MetaNo <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    comment2MetaNo = <span class="string">&quot;U&quot;</span></span><br><span class="line">   <span class="comment"> Rem 声明类型 对应列的 英文序号</span></span><br><span class="line">    <span class="keyword">Dim</span> typeMetaNo <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    typeMetaNo = <span class="string">&quot;G&quot;</span></span><br><span class="line">   <span class="comment"> Rem 声明字长 对应的列的英文序号</span></span><br><span class="line">    <span class="keyword">Dim</span> lengthMetaNo <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    lengthMetaNo = <span class="string">&quot;H&quot;</span></span><br><span class="line">    </span><br><span class="line">   <span class="comment"> Rem 最终要拼接的sql</span></span><br><span class="line">    <span class="keyword">Dim</span> sqlStr <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    sqlStr = <span class="string">&quot;CREATE TABLE &quot;</span> &amp; Range(<span class="string">&quot;E&quot;</span> &amp; <span class="number">6</span>) &amp; Chr(<span class="number">13</span>)</span><br><span class="line">    sqlStr = sqlStr &amp; <span class="string">&quot;(&quot;</span> &amp; Chr(<span class="number">13</span>)</span><br><span class="line">    <span class="keyword">For</span> count = startRow <span class="keyword">To</span> endRow</span><br><span class="line">      <span class="comment"> Rem 拼接 字段名</span></span><br><span class="line">       sqlStr = sqlStr &amp; Replace(Range(filedMetaNo &amp; count).<span class="keyword">Text</span>, <span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">      <span class="comment"> Rem 拼接  字段类型(字段长度)</span></span><br><span class="line">       sqlStr = sqlStr &amp; <span class="string">&quot;   &quot;</span> &amp; Range(typeMetaNo &amp; count)</span><br><span class="line">       <span class="keyword">If</span> IsEmpty(Range(lengthMetaNo &amp; count)) = <span class="literal">False</span> <span class="keyword">Then</span></span><br><span class="line">         sqlStr = sqlStr &amp; <span class="string">&quot;(&quot;</span> &amp; Range(lengthMetaNo &amp; count) &amp; <span class="string">&quot;)  &quot;</span></span><br><span class="line">       <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">      <span class="comment"> Rem 如果是主键，设置NOT NULL COMMENT</span></span><br><span class="line">       <span class="keyword">If</span> primaryKey = Range(filedMetaNo &amp; count) <span class="keyword">Then</span></span><br><span class="line">         sqlStr = sqlStr &amp; <span class="string">&quot; NOT NULL COMMENT &quot;</span></span><br><span class="line">       <span class="keyword">Else</span></span><br><span class="line">       <span class="comment"> Rem 拼接  DEFAULT NULL COMMENT  &#x27;字段名称注释(字段备注)&#x27;</span></span><br><span class="line">       sqlStr = sqlStr &amp; <span class="string">&quot; DEFAULT NULL COMMENT &quot;</span></span><br><span class="line">       <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">       sqlStr = sqlStr &amp; <span class="string">&quot;&#x27;&quot;</span> &amp; Range(commentMetaNo &amp; count)</span><br><span class="line">       <span class="keyword">If</span> IsEmpty(Range(comment2MetaNo &amp; count)) = <span class="literal">False</span> <span class="keyword">Then</span></span><br><span class="line">        sqlStr = sqlStr &amp; <span class="string">&quot;(&quot;</span> &amp; Range(comment2MetaNo &amp; count) &amp; <span class="string">&quot;)&quot;</span></span><br><span class="line">       <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">       sqlStr = sqlStr &amp; <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">       sqlStr = sqlStr &amp; <span class="string">&quot;,&quot;</span> &amp; Chr(<span class="number">13</span>)</span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line">    sqlStr = sqlStr &amp; <span class="string">&quot;PRIMARY KEY (&quot;</span> &amp; primaryKey &amp; <span class="string">&quot;)&quot;</span> &amp; Chr(<span class="number">13</span>)</span><br><span class="line">    sqlStr = sqlStr &amp; <span class="string">&quot;)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;&quot;</span> &amp; tableComment &amp; <span class="string">&quot;&#x27;&quot;</span> &amp; Chr(<span class="number">13</span>)</span><br><span class="line">    Debug.Print sqlStr</span><br><span class="line"> <span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>显示结果：<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/8c4a0502ddf5ddae02c0acd71ce9f981_1737630881461.png" alt="在这里插入图片描述"></p>
<p>在navicat中运行<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/d7197504f9c263e6a154a4733554cd27_1737630881461.png" alt="在这里插入图片描述"></p>
<p>显示已经把mysql数据库的表结构导入数据库了。</p>
<h2 id="见证奇迹的时刻（如何使用脚本）"><a href="#见证奇迹的时刻（如何使用脚本）" class="headerlink" title="见证奇迹的时刻（如何使用脚本）"></a>见证奇迹的时刻（如何使用脚本）</h2><p>脚本只需要改一个地方:<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/3e88e190f4d8ee63890d61aa7d1a12ff_1737630881461.png" alt="在这里插入图片描述"><br>对应这里的行号:<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/abd8ffade0d26009f24a3f2f50b52dd2_1737630896527.png" alt="在这里插入图片描述"><br>即可。</p>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/30d7ce340b49e92fe35eb42a7744c1c2_1737630896527.png" alt="在这里插入图片描述"></p>
<p>以上即是用脚本生成的4张表效果图。</p>
<hr>
<p>个人微信公众号：<br>搜索： 怒放de每一天<br>不定时推送相关文章，期待和大家一起成长！！<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/undefined/img/2025-1-13/42409b1dbd9a6b7ff63471ea0769592d_1737631173950.png" alt="在这里插入图片描述"></p>
<hr>
<p>完</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hufanglei.github.io/2020/05/20/%E5%B0%86%E6%9C%AC%E5%9C%B0%E7%AC%AC%E4%B8%89%E6%96%B9jar%E5%8C%85%E6%89%93%E5%85%A5maven%E7%A7%81%E6%9C%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="胡方雷">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/20/%E5%B0%86%E6%9C%AC%E5%9C%B0%E7%AC%AC%E4%B8%89%E6%96%B9jar%E5%8C%85%E6%89%93%E5%85%A5maven%E7%A7%81%E6%9C%8D/" class="post-title-link" itemprop="url">将本地第三方jar包打入maven私服</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-20 11:30:40" itemprop="dateCreated datePublished" datetime="2020-05-20T11:30:40+08:00">2020-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-24 11:37:59" itemprop="dateModified" datetime="2025-01-24T11:37:59+08:00">2025-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/java%E5%9F%BA%E7%A1%80-%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">java基础 运维</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>895</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<p>@[TOC]</p>
<blockquote>
<p>本人需求: 本地有个华为云的obs的jar包，版本是最新的release版本，maven中央仓库没有最新的，于是自己想到，要把本地下载的最新obs 的jar包，打到<code>maven私服</code>中去。<br>一般情况下:<br>在nexus私服的页面上就可以手动上传，但是没给我开放页面upload权限，只能使用部署命令了。</p>
</blockquote>
<h1 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h1><h2 id="前提，本地settings配置maven私服地址。"><a href="#前提，本地settings配置maven私服地址。" class="headerlink" title="前提，本地settings配置maven私服地址。"></a>前提，本地settings配置maven私服地址。</h2><h2 id="1-cmd输入部署命令"><a href="#1-cmd输入部署命令" class="headerlink" title="1.cmd输入部署命令:"></a>1.cmd输入部署命令:</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mvn deploy:deploy-file ^</span><br><span class="line">-DgroupId=com.huaweicloud ^</span><br><span class="line">-DartifactId=esdk-obs-java ^</span><br><span class="line">-Dversion=3.20.4 ^</span><br><span class="line">-Dpackaging=jar ^</span><br><span class="line">-Dfile=D:/soft/huaweicloud-obs-sdk-java_3.20.4/esdk-obs-java-3.20.4.jar ^</span><br><span class="line">-Durl=http://x.x.x.x/repository/wz_dev_release/ ^</span><br><span class="line">-DrepositoryId=wz_dev_release ^</span><br></pre></td></tr></table></figure>
<blockquote>
</blockquote>
<p>参数说明:</p>
<p>mvn deploy:deploy-file</p>
<p>-DgroupId&#x3D;xxxxxx 就相当于pom中的groupId<br>-DartifactId&#x3D;xxxxxx 就相当于pom中的artifactId<br>-Dversion&#x3D;xxxxxx 就相当于pom中的版本号version<br>-Dpackaging&#x3D;xxxxxx 就相当于pom中打包方式<br>-Dfile&#x3D;xxxxxx 本地环境<br>-Durl&#x3D;xxxxxx 上传的url<br>-DrepositoryId&#x3D;xxxxxx 对应的是setting.xml 里边的id</p>
<h2 id="2-执行-一路回车"><a href="#2-执行-一路回车" class="headerlink" title="2.执行 一路回车"></a>2.执行 一路回车</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/4194e87afa438866f644620f7840e25c_1737630896527.png" alt="在这里插入图片描述"><br>显示成功:</p>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/cb8fa7d1e931686e01b14febe03d2983_1737630896527.png" alt="在这里插入图片描述"></p>
<hr>
<p>参考1:<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/chywx/p/11227151.html">https://www.cnblogs.com/chywx/p/11227151.html</a></p>
<p>参考2： windows命令换行写法:<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/bingco/p/11372199.html">https://www.cnblogs.com/bingco/p/11372199.html</a><br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/0903e3978433b8a982e9baace9d84acd_1737630908759.png" alt="在这里插入图片描述"></p>
<hr>
<p>个人微信公众号：<br>搜索： 怒放de每一天<br>不定时推送相关文章，期待和大家一起成长！！<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/undefined/img/2025-1-13/42409b1dbd9a6b7ff63471ea0769592d_1737631173950.png" alt="在这里插入图片描述"></p>
<hr>
<p>完</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hufanglei.github.io/2020/05/20/%E6%97%A0%E6%B3%95%E5%BB%BA%E7%AB%8B%E5%88%B0%20raw.githubusercontent.com%20%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%20IP%20%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="胡方雷">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/20/%E6%97%A0%E6%B3%95%E5%BB%BA%E7%AB%8B%E5%88%B0%20raw.githubusercontent.com%20%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%20IP%20%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/" class="post-title-link" itemprop="url">无法建立到 raw.githubusercontent.com 的服务器 IP 地址，解决办法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-20 10:44:58" itemprop="dateCreated datePublished" datetime="2020-05-20T10:44:58+08:00">2020-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-24 11:37:59" itemprop="dateModified" datetime="2025-01-24T11:37:59+08:00">2025-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>145</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>


<p>@[toc]<br>无法连接到 raw.githubusercontent.com 的服务器 IP 地址，解决办法<br>在C:\Windows\System32\drivers\etc路径下找到hosts文件<br>添加 以下内容并保存即可恢复</p>
<blockquote>
<p><code>199.232.68.133 raw.githubusercontent.com</code></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hufanglei.github.io/2020/05/20/sql%20left%20join%E5%86%85%E9%83%A8%E9%93%BE%E6%8E%A5%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="胡方雷">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/20/sql%20left%20join%E5%86%85%E9%83%A8%E9%93%BE%E6%8E%A5%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">sql left join内部链接原理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-20 10:23:49" itemprop="dateCreated datePublished" datetime="2020-05-20T10:23:49+08:00">2020-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-24 11:37:59" itemprop="dateModified" datetime="2025-01-24T11:37:59+08:00">2025-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/java%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">java基础</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>67</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<p>@[toc]<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/junhongzhang/article/details/100645094">https://blog.csdn.net/junhongzhang/article/details/100645094</a></p>
<hr>
<p>完</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hufanglei.github.io/2020/05/19/Delegate%20%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%BC%8F%E5%92%8C%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8Fstrategy%E7%9A%84%E5%8C%BA%E5%88%AB!%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%B6%88%E9%99%A4%E5%A4%9A%E5%B1%82if%20else/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="胡方雷">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/19/Delegate%20%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%BC%8F%E5%92%8C%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8Fstrategy%E7%9A%84%E5%8C%BA%E5%88%AB!%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%B6%88%E9%99%A4%E5%A4%9A%E5%B1%82if%20else/" class="post-title-link" itemprop="url">Delegate 委派模式和代理模式strategy的区别?策略模式如何实现消除多层if else?</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-19 21:06:12" itemprop="dateCreated datePublished" datetime="2020-05-19T21:06:12+08:00">2020-05-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-24 11:37:59" itemprop="dateModified" datetime="2025-01-24T11:37:59+08:00">2025-01-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>11 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <span id="more"></span>

<p>@[toc]</p>
<h1 id="委派模式"><a href="#委派模式" class="headerlink" title="委派模式"></a>委派模式</h1><p>委派模式，可以精简程序逻辑，提升代码的可读性。<br>委派模式（Delegate Pattern）的基本作用就是负责任务的调用和分配任务。<br>例如：老板（Boss）给项目经理（Leader）下达任务，项目经理会根据实际情况给每个员工派发工作任务，待员工把工作任务完成之后，再由项目经理汇报工作进度和结果给老板。<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/31b39e9467c62117fff08a622c37e82d_1737630908759.png" alt="在这里插入图片描述"></p>
<h2 id="和代理模式的区别"><a href="#和代理模式的区别" class="headerlink" title="和代理模式的区别"></a>和代理模式的区别</h2><p>跟代理模式很像，可以看做是一种特殊情况下的静态代理的全权代理，但是代理模式注重过程，而委派模式注重结果。委派模式在Spring 中应用非常多，常用的DispatcherServlet 其实就是用到了委派模式。</p>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/c3dd31078efc805ff053ae5f8e4e1a31_1737630908759.png" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IEmployee</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doing</span><span class="params">(String command)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeA</span> <span class="keyword">implements</span> <span class="title class_">IEmployee</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doing</span><span class="params">(String command)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是员工A，我现在开始干&quot;</span> + command + <span class="string">&quot;工作&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeB</span> <span class="keyword">implements</span> <span class="title class_">IEmployee</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doing</span><span class="params">(String command)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是员工B，我现在开始干&quot;</span> + command + <span class="string">&quot;工作&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">````</span><br><span class="line">```java</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Leader</span> <span class="keyword">implements</span> <span class="title class_">IEmployee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, IEmployee&gt; targets = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Leader</span><span class="params">()</span> &#123;</span><br><span class="line">        targets.put(<span class="string">&quot;登录&quot;</span>, <span class="keyword">new</span> <span class="title class_">EmployeeA</span>());</span><br><span class="line">        targets.put(<span class="string">&quot;加密&quot;</span>, <span class="keyword">new</span> <span class="title class_">EmployeeB</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doing</span><span class="params">(String command)</span> &#123;</span><br><span class="line">        targets.get(command).doing(command);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Boss</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">command</span><span class="params">(String command, Leader leader)</span> &#123;</span><br><span class="line">        leader.doing(command);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>测试:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelegateTest</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="comment">//客户请求（Boss）、委派者（Leader）、被被委派者（Target）</span></span><br><span class="line">	<span class="comment">//委派者要持有被委派者的引用</span></span><br><span class="line">	<span class="comment">//代理模式注重的是过程， 委派模式注重的是结果</span></span><br><span class="line">	<span class="comment">//策略模式注重是可扩展（外部扩展），委派模式注重内部的灵活和复用</span></span><br><span class="line">	<span class="comment">//委派的核心：就是分发、调度、派遣</span></span><br><span class="line">	<span class="comment">//委派模式：就是静态代理和策略模式一种特殊的组合</span></span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">Boss</span>().command(<span class="string">&quot;登录&quot;</span>,<span class="keyword">new</span> <span class="title class_">Leader</span>());</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">Boss</span>().command(<span class="string">&quot;加密&quot;</span>, <span class="keyword">new</span> <span class="title class_">Leader</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/424a9206e323715308216e37da9befd6_1737630908759.png" alt="在这里插入图片描述"></p>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>手写一个DispatcherServlet: DispatcherServlet根据url分配到对应的controller的method方法就体现了委派模式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            doDispatch(req, resp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">mid</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;mid&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;/getMemberById&quot;</span>.equals(uri)) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">MemberController</span>().getMemberById(mid);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;/getOrderById&quot;</span>.equals(uri)) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">OrderController</span>().getOrderById(mid);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;/logout&quot;</span>.equals(uri)) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">SystemController</span>().logout();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            response.getWriter().write(<span class="string">&quot;404 Not Found!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMemberById</span><span class="params">(String mid)</span>&#123;</span><br><span class="line">        System.out.println(mid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getOrderById</span><span class="params">(String mid)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logout</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/546ce48646495b2ce26b991d21b5dade_1737630921474.png" alt="在这里插入图片描述"><br>策略模式（Strategy Pattern）是指定义了算法家族、分别封装起来，让它们之间可以互相替换，此模式让算法的变化不会影响到使用算法的用户。<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/8876f254f425e405cb8a24ce7b70d64c_1737630921474.png" alt="在这里插入图片描述"></p>
<p>策略模式的应用场景<br>1、假如系统中有很多类，而他们的区别仅仅在于他们的行为不同。<br>2、一个系统需要动态地在几种算法中选择一种。<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/003ca328c296346e1a6d8556fe1f79d0_1737630921474.png" alt="在这里插入图片描述"></p>
<h2 id="案例1。"><a href="#案例1。" class="headerlink" title="案例1。"></a>案例1。</h2><blockquote>
<p>课程经常会有优惠活动，优惠策略会有很多种可能<br>如：领取优惠券抵扣、返现促销、拼团优惠。下面我们用代码来模拟，首先我们创建一<br>个促销策略的抽象PromotionStrategy</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/2b75ffd1e3d4f48705116142e46a8b3f_1737630921474.png" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PromotionStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doPromotion</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返现活动</span></span><br><span class="line"><span class="comment"> * Created by HFL</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CashbackStrategy</span> <span class="keyword">implements</span> <span class="title class_">PromotionStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPromotion</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;返现促销,返回的金额转到支付宝账号&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 优惠券</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CouponStrategy</span> <span class="keyword">implements</span> <span class="title class_">PromotionStrategy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPromotion</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;领取优惠券,课程的价格直接减优惠券面值抵扣&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 无优惠</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmptyStrategy</span> <span class="keyword">implements</span> <span class="title class_">PromotionStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPromotion</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;无促销活动&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 拼团优惠</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GroupbuyStrategy</span> <span class="keyword">implements</span> <span class="title class_">PromotionStrategy</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPromotion</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;拼团，满20人成团，全团享受团购价&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>优惠活动</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PromotionActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PromotionStrategy promotionStrategy;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PromotionActivity</span><span class="params">(PromotionStrategy promotionStrategy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.promotionStrategy = promotionStrategy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>&#123;</span><br><span class="line">        promotionStrategy.doPromotion();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试1：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PromotionActivityTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">PromotionActivity</span> <span class="variable">activity618</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromotionActivity</span>(<span class="keyword">new</span> <span class="title class_">CouponStrategy</span>());</span><br><span class="line">        <span class="type">PromotionActivity</span> <span class="variable">activity1111</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromotionActivity</span>(<span class="keyword">new</span> <span class="title class_">CashbackStrategy</span>());</span><br><span class="line"></span><br><span class="line">        activity618.execute();</span><br><span class="line">        activity1111.execute();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/e7687ad8906f473066954cafeeb8b84b_1737630921474.png" alt="在这里插入图片描述"><br>根据前端的条件选择哪种策略方式:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     <span class="type">PromotionActivity</span> <span class="variable">promotionActivity</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">     <span class="type">String</span> <span class="variable">promotionKey</span> <span class="operator">=</span> <span class="string">&quot;CASHBACK&quot;</span>;</span><br><span class="line">     <span class="keyword">if</span>(StringUtils.equals(promotionKey,<span class="string">&quot;COUPON&quot;</span>))&#123;</span><br><span class="line">         promotionActivity = <span class="keyword">new</span> <span class="title class_">PromotionActivity</span>(<span class="keyword">new</span> <span class="title class_">CouponStrategy</span>());</span><br><span class="line">     &#125;<span class="keyword">else</span> <span class="keyword">if</span>(StringUtils.equals(promotionKey,<span class="string">&quot;CASHBACK&quot;</span>))&#123;</span><br><span class="line">         promotionActivity = <span class="keyword">new</span> <span class="title class_">PromotionActivity</span>(<span class="keyword">new</span> <span class="title class_">CashbackStrategy</span>());</span><br><span class="line">     &#125;<span class="comment">//......</span></span><br><span class="line">     promotionActivity.execute();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>从形式上看，这这个测试类根据条件，类似简单工厂。所以我们可以改成简单工厂的方法优化下:<br>再写个简单工厂类.用于生产策略类:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PromotionStrategyFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String,PromotionStrategy&gt; PROMOTION_STRATEGY_MAP = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, PromotionStrategy&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        PROMOTION_STRATEGY_MAP.put(PromotionKey.COUPON,<span class="keyword">new</span> <span class="title class_">CouponStrategy</span>());</span><br><span class="line">        PROMOTION_STRATEGY_MAP.put(PromotionKey.CASHBACK,<span class="keyword">new</span> <span class="title class_">CashbackStrategy</span>());</span><br><span class="line">        PROMOTION_STRATEGY_MAP.put(PromotionKey.GROUPBUY,<span class="keyword">new</span> <span class="title class_">GroupbuyStrategy</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">PromotionStrategy</span> <span class="variable">NON_PROMOTION</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmptyStrategy</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">PromotionStrategyFactory</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PromotionStrategy <span class="title function_">getPromotionStrategy</span><span class="params">(String promotionKey)</span>&#123;</span><br><span class="line">        <span class="type">PromotionStrategy</span> <span class="variable">promotionStrategy</span> <span class="operator">=</span> PROMOTION_STRATEGY_MAP.get(promotionKey);</span><br><span class="line">        <span class="keyword">return</span> promotionStrategy == <span class="literal">null</span> ? NON_PROMOTION : promotionStrategy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">interface</span> <span class="title class_">PromotionKey</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">COUPON</span> <span class="operator">=</span> <span class="string">&quot;COUPON&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">CASHBACK</span> <span class="operator">=</span> <span class="string">&quot;CASHBACK&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">GROUPBUY</span> <span class="operator">=</span> <span class="string">&quot;GROUPBUY&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重写测试类:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">promotionKey</span> <span class="operator">=</span> <span class="string">&quot;GROUPBUY&quot;</span>;</span><br><span class="line">      <span class="type">PromotionActivity</span> <span class="variable">promotionActivity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromotionActivity</span>(PromotionStrategyFactory.getPromotionStrategy(promotionKey));</span><br><span class="line">      promotionActivity.execute();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/842e1f0acffba296bbd89b4509f2f9af_1737630932705.png" alt="在这里插入图片描述"></p>
<h2 id="案例2：订单支付策略案例"><a href="#案例2：订单支付策略案例" class="headerlink" title="案例2：订单支付策略案例"></a>案例2：订单支付策略案例</h2><p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/566541e2ad101fe517bcf438d1c9ce20_1737630932705.png" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 支付渠道</span></span><br><span class="line"><span class="comment"> * .</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Payment</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//支付类型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询余额</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="type">double</span> <span class="title function_">queryBalance</span><span class="params">(String uid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//扣款支付</span></span><br><span class="line">    <span class="keyword">public</span> MsgResult <span class="title function_">pay</span><span class="params">(String uid, <span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(queryBalance(uid) &lt; amount)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MsgResult</span>(<span class="number">500</span>,<span class="string">&quot;支付失败&quot;</span>,<span class="string">&quot;余额不足&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MsgResult</span>(<span class="number">200</span>,<span class="string">&quot;支付成功&quot;</span>,<span class="string">&quot;支付金额：&quot;</span> + amount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDPay</span> <span class="keyword">extends</span> <span class="title class_">Payment</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;京东白条&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">double</span> <span class="title function_">queryBalance</span><span class="params">(String uid)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">500</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliPay</span> <span class="keyword">extends</span> <span class="title class_">Payment</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;支付宝&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">double</span> <span class="title function_">queryBalance</span><span class="params">(String uid)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">900</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnionPay</span> <span class="keyword">extends</span> <span class="title class_">Payment</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;银联支付&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">double</span> <span class="title function_">queryBalance</span><span class="params">(String uid)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">120</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatPay</span> <span class="keyword">extends</span> <span class="title class_">Payment</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;微信支付&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">double</span> <span class="title function_">queryBalance</span><span class="params">(String uid)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">256</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>策略类(最重要)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ALI_PAY</span> <span class="operator">=</span> <span class="string">&quot;AliPay&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JD_PAY</span> <span class="operator">=</span> <span class="string">&quot;JdPay&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">UNION_PAY</span> <span class="operator">=</span> <span class="string">&quot;UnionPay&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">WECHAT_PAY</span> <span class="operator">=</span> <span class="string">&quot;WechatPay&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_PAY</span> <span class="operator">=</span> ALI_PAY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Payment&gt; payStrategy = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Payment&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        payStrategy.put(ALI_PAY, <span class="keyword">new</span> <span class="title class_">AliPay</span>());</span><br><span class="line">        payStrategy.put(WECHAT_PAY, <span class="keyword">new</span> <span class="title class_">WechatPay</span>());</span><br><span class="line">        payStrategy.put(UNION_PAY, <span class="keyword">new</span> <span class="title class_">UnionPay</span>());</span><br><span class="line">        payStrategy.put(JD_PAY, <span class="keyword">new</span> <span class="title class_">JDPay</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Payment <span class="title function_">get</span><span class="params">(String payKey)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!payStrategy.containsKey(payKey)) &#123;</span><br><span class="line">            <span class="keyword">return</span> payStrategy.get(DEFAULT_PAY);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> payStrategy.get(payKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>支付完后的响应对象:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MsgResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MsgResult</span><span class="params">(<span class="type">int</span> code, String msg, Object data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;支付状态：[&quot;</span> + code + <span class="string">&quot;],&quot;</span> + msg + <span class="string">&quot;,交易详情：&quot;</span> + data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayStrategyTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//省略把商品添加到购物车，再从购物车下单</span></span><br><span class="line">        <span class="comment">//直接从点单开始</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;20180311001000009&quot;</span>,<span class="number">324.45</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//开始支付，选择微信支付、支付宝、银联卡、京东白条、财付通</span></span><br><span class="line">        <span class="comment">//每个渠道它支付的具体算法是不一样的</span></span><br><span class="line">        <span class="comment">//基本算法固定的</span></span><br><span class="line">        <span class="type">MsgResult</span> <span class="variable">pay</span> <span class="operator">=</span> order.pay(PayStrategy.JD_PAY);</span><br><span class="line">        <span class="comment">//这个值是在支付的时候才决定用哪个值</span></span><br><span class="line"><span class="comment">//        System.out.println(order.pay(PayStrategy.ALI_PAY));</span></span><br><span class="line">        System.out.println(pay);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//java中的应用</span></span><br><span class="line"><span class="comment">//        Arrays.sort();</span></span><br><span class="line">        <span class="comment">//Resource</span></span><br><span class="line"><span class="comment">//        InstantiationStrategy</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/f157e9bdf5e8dd74c64b9d27c2be5b65_1737630932705.png" alt="在这里插入图片描述"></p>
<p>切换成支付宝支付:<br>只要改一个参数:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MsgResult</span> <span class="variable">pay</span> <span class="operator">=</span> order.pay(PayStrategy.JD_PAY);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/main/img/2025-1-13/b6a3b3c518d048816c49a0fdb13e6200_1737630932705.png" alt="在这里插入图片描述"></p>
<h2 id="策略模式在JDK-源码中的体现"><a href="#策略模式在JDK-源码中的体现" class="headerlink" title="策略模式在JDK 源码中的体现"></a>策略模式在JDK 源码中的体现</h2><h3 id="Arrays-类的parallelSort-方法等"><a href="#Arrays-类的parallelSort-方法等" class="headerlink" title="Arrays 类的parallelSort 方法等"></a>Arrays 类的parallelSort 方法等</h3><p>compare()方法，就是一个策略抽象实现.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Arrays</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">parallelSort</span><span class="params">(T[] a, <span class="type">int</span> fromIndex, <span class="type">int</span> toIndex,</span></span><br><span class="line"><span class="params">Comparator&lt;? <span class="built_in">super</span> T&gt; cmp)</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Comparator</span>&lt;T&gt; &#123;</span><br><span class="line"><span class="type">int</span> <span class="title function_">compare</span><span class="params">(T o1, T o2)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="策略模式的优缺点"><a href="#策略模式的优缺点" class="headerlink" title="策略模式的优缺点"></a>策略模式的优缺点</h2><p>优点：<br>1、策略模式符合开闭原则。<br>2、避免使用多重条件转移语句，如if…else…语句、switch 语句<br>3、使用策略模式可以提高算法的保密性和安全性。<br>缺点：<br>1、客户端必须知道所有的策略，并且自行决定使用哪一个策略类。<br>2、代码中会产生非常多策略类，增加维护难度。</p>
<h1 id="委派模式与策略模式综合应用"><a href="#委派模式与策略模式综合应用" class="headerlink" title="委派模式与策略模式综合应用"></a>委派模式与策略模式综合应用</h1><p>刚才的委派模式中的dispatchsevlet:实际项目中一定不止这几个Controller，往往是成千上万个Controller，显然，我们不能写成千上万个if…else… 。那么我们如何来改造呢,用策略模式:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Handler&gt; handlerMapping = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Handler&gt;();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; memberControllerClass = MemberController.class;</span><br><span class="line">            handlerMapping.add(<span class="keyword">new</span> <span class="title class_">Handler</span>()</span><br><span class="line">                    .setController(memberControllerClass.newInstance())</span><br><span class="line">                    .setMethod(memberControllerClass.getMethod(<span class="string">&quot;getMemberById&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;))</span><br><span class="line">                    .setUrl(<span class="string">&quot;/web/getMemberById.json&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            doDispatch(req, resp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1、获取用户请求的url</span></span><br><span class="line">        <span class="comment">//   如果按照J2EE的标准、每个url对对应一个Serlvet，url由浏览器输入</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、Servlet拿到url以后，要做权衡（要做判断，要做选择）</span></span><br><span class="line">        <span class="comment">//   根据用户请求的URL，去找到这个url对应的某一个java类的方法</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、通过拿到的URL去handlerMapping（我们把它认为是策略常量）</span></span><br><span class="line">        <span class="type">Handler</span> <span class="variable">handle</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (Handler h : handlerMapping) &#123;</span><br><span class="line">            <span class="keyword">if</span> (uri.equals(h.getUrl())) &#123;</span><br><span class="line">                handle = h;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4、将具体的任务分发给Method（通过反射去调用其对应的方法）</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            object = handle.getMethod().invoke(handle.getController(), request.getParameter(<span class="string">&quot;mid&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5、获取到Method执行的结果，通过Response返回出去</span></span><br><span class="line">        response.getWriter().write(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Object controller;</span><br><span class="line">        <span class="keyword">private</span> Method method;</span><br><span class="line">        <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Object <span class="title function_">getController</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> controller;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Handler <span class="title function_">setController</span><span class="params">(Object controller)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.controller = controller;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Method <span class="title function_">getMethod</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> method;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Handler <span class="title function_">setMethod</span><span class="params">(Method method)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.method = method;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getUrl</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> url;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Handler <span class="title function_">setUrl</span><span class="params">(String url)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.url = url;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>总结:<br>1.使用委派模式，可以写出更加优雅的代码。<br>2.策略模式，可以消除程序中大量的冗余代码和多重条件转移语句。<br>3.委派模式属于行为型模式，基本作用就是负责任务的调度和分配任务，跟代理模式很像，可以看做是一种特殊情况下的静态代理的全权代理，但是代理模式注重过程，而委派模式注重结果。<br>4.策略模式是行为型模式:（Strategy Pattern）是指定义了算法家族、分别封装起来，让它们之间可以互相替换，此模式让算法的变化不会影响到使用算法的用户。可以避免多重分支的if…else…和switch语句.</p>
<hr>
<p>个人微信公众号：<br>搜索： 怒放de每一天<br>不定时推送相关文章，期待和大家一起成长！！<br><img src="https://raw.githubusercontent.com/hufanglei/img-csdn/undefined/img/2025-1-13/42409b1dbd9a6b7ff63471ea0769592d_1737631173950.png" alt="在这里插入图片描述"></p>
<hr>
<p>完</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/22/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/60/">60</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/24/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">胡方雷</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">1.8m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">26:40</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/hufanglei" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
